------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\lsh1703468\Documents\repos\logs/covid_matching.log
  log type:  text
 opened on:   6 Oct 2022, 13:41:29

. clear

. 
. import delimited ./output/input_covid_matching.csv, delimiter(comma) varnames(1) case(preserve) 
(encoding automatically selected: ISO-8859-2)
(46 vars, 50,000 obs)

. 
. **Exclusions
. * Age <18
. drop if age <18
(10,810 observations deleted)

. 
. * Anyone not registered at one practice for 3 months before COVID-19 diagnosis
. drop if has_follow_up==0
(1,945 observations deleted)

. drop has_follow_up

. 
. * Pre-existing kidney replacement therapy
. drop if baseline_krt_primary_care==1
(1,859 observations deleted)

. drop baseline_krt_primary_care

. drop if baseline_krt_icd_10==1
(1,748 observations deleted)

. drop baseline_krt_icd_10

. drop if baseline_krt_opcs_4==1
(1,671 observations deleted)

. drop baseline_krt_opcs_4

. 
. * Baseline eGFR <15 as at February 2020
. assert inlist(sex, "M", "F")

. gen male = (sex=="M")

. drop sex

. label define sexLab 1 "Male" 0 "Female"

. label values male sexLab

. label var male "Sex (0=F 1=M)"

. 
. replace baseline_creatinine_feb2020 = . if !inrange(baseline_creatinine_feb2020, 20, 3000)
(14,136 real changes made, 14,136 to missing)

. gen mgdl_baseline_creatinine_feb2020 = baseline_creatinine_feb2020/88.4
(14,136 missing values generated)

. gen min_baseline_creatinine_feb2020=.
(31,967 missing values generated)

. replace min_baseline_creatinine_feb2020 = mgdl_baseline_creatinine_feb2020/0.7 if male==0
(9,017 real changes made)

. replace min_baseline_creatinine_feb2020 = mgdl_baseline_creatinine_feb2020/0.9 if male==1
(8,814 real changes made)

. replace min_baseline_creatinine_feb2020 = min_baseline_creatinine_feb2020^-0.329  if male==0
(9,017 real changes made)

. replace min_baseline_creatinine_feb2020 = min_baseline_creatinine_feb2020^-0.411  if male==1
(8,814 real changes made)

. replace min_baseline_creatinine_feb2020 = 1 if min_baseline_creatinine_feb2020<1
(11,306 real changes made)

. gen max_baseline_creatinine_feb2020=.
(31,967 missing values generated)

. replace max_baseline_creatinine_feb2020 = mgdl_baseline_creatinine_feb2020/0.7 if male==0
(9,017 real changes made)

. replace max_baseline_creatinine_feb2020 = mgdl_baseline_creatinine_feb2020/0.9 if male==1
(8,814 real changes made)

. replace max_baseline_creatinine_feb2020 = max_baseline_creatinine_feb2020^-1.209
(17,831 real changes made)

. replace max_baseline_creatinine_feb2020 = 1 if max_baseline_creatinine_feb2020>1
(20,661 real changes made)

. gen egfr_baseline_creatinine_feb2020 = min_baseline_creatinine_feb2020*max_baseline_creatinine_feb2020*141
(14,136 missing values generated)

. replace egfr_baseline_creatinine_feb2020 = egfr_baseline_creatinine_feb2020*(0.993^age)
(17,831 real changes made)

. replace egfr_baseline_creatinine_feb2020 = egfr_baseline_creatinine_feb2020*1.018 if male==0
(9,017 real changes made)

. drop if egfr_baseline_creatinine_feb2020 <15
(0 observations deleted)

. drop baseline_creatinine_feb2020

. drop mgdl_baseline_creatinine_feb2020

. drop min_baseline_creatinine_feb2020

. drop max_baseline_creatinine_feb2020

. 
. * Baseline eGFR <15 at time of COVID diagnosis using baseline creatinine updated monthly
. gen covid_date = date(covid_diagnosis_date, "YMD")
(17,589 missing values generated)

. format covid_date %td

. drop if covid_date ==.
(17,589 observations deleted)

. drop sgss_positive_date

. drop primary_care_covid_date

. drop hospital_covid_date

. drop sars_cov_2

. 
. foreach baseline_creatinine_monthly of varlist  baseline_creatinine_mar2020 ///
>                                                                                                 baseline_creatinine_apr2020 ///
>                                                                                                 baseline_creatinine_may2020 ///
>                                                                                                 baseline_creatinine_jun2020 ///
>                                                                                                 baseline_creatinine_jul2020 ///
>                                                                                                 baseline_creatinine_aug2020 ///
>                                                                                                 baseline_creatinine_sep2020 ///
>                                                                                                 baseline_creatinine_oct2020 ///
>                                                                                                 baseline_creatinine_nov2020 ///
>                                                                                                 baseline_creatinine_dec2020 ///
>                                                                                                 baseline_creatinine_jan2021 ///
>                                                                                                 baseline_creatinine_feb2021 ///
>                                                                                                 baseline_creatinine_mar2021 ///
>                                                                                                 baseline_creatinine_apr2021 ///
>                                                                                                 baseline_creatinine_may2021 ///
>                                                                                                 baseline_creatinine_jun2021 ///
>                                                                                                 baseline_creatinine_jul2021 ///
>                                                                                                 baseline_creatinine_aug2021 ///
>                                                                                                 baseline_creatinine_sep2021 ///
>                                                                                                 baseline_creatinine_oct2021 ///
>                                                                                                 baseline_creatinine_nov2021 ///
>                                                                                                 baseline_creatinine_dec2021 ///
>                                                                                                 baseline_creatinine_jan2022 {
  2. replace `baseline_creatinine_monthly' = . if !inrange(`baseline_creatinine_monthly', 20, 3000)
  3. gen mgdl_`baseline_creatinine_monthly' = `baseline_creatinine_monthly'/88.4
  4. gen min_`baseline_creatinine_monthly'=.
  5. replace min_`baseline_creatinine_monthly' = mgdl_`baseline_creatinine_monthly'/0.7 if male==0
  6. replace min_`baseline_creatinine_monthly' = mgdl_`baseline_creatinine_monthly'/0.9 if male==1
  7. replace min_`baseline_creatinine_monthly' = min_`baseline_creatinine_monthly'^-0.329 if male==0
  8. replace min_`baseline_creatinine_monthly' = min_`baseline_creatinine_monthly'^-0.411 if male==1
  9. replace min_`baseline_creatinine_monthly' = 1 if min_`baseline_creatinine_monthly'<1
 10. gen max_`baseline_creatinine_monthly'=.
 11. replace max_`baseline_creatinine_monthly' = mgdl_`baseline_creatinine_monthly'/0.7 if male==0
 12. replace max_`baseline_creatinine_monthly' = mgdl_`baseline_creatinine_monthly'/0.9 if male==1
 13. replace max_`baseline_creatinine_monthly' = max_`baseline_creatinine_monthly'^-1.209
 14. replace max_`baseline_creatinine_monthly' = 1 if max_`baseline_creatinine_monthly'>1
 15. gen egfr_`baseline_creatinine_monthly' = min_`baseline_creatinine_monthly'*max_`baseline_creatinine_monthly'*141
 16. replace egfr_`baseline_creatinine_monthly' = egfr_`baseline_creatinine_monthly'*(0.993^age)
 17. replace egfr_`baseline_creatinine_monthly' = egfr_`baseline_creatinine_monthly'*1.018 if male==0
 18. drop `baseline_creatinine_monthly'
 19. drop mgdl_`baseline_creatinine_monthly'
 20. drop min_`baseline_creatinine_monthly'
 21. drop max_`baseline_creatinine_monthly'
 22. }
(6,358 real changes made, 6,358 to missing)
(6,358 missing values generated)
(14,378 missing values generated)
(4,068 real changes made)
(3,952 real changes made)
(4,068 real changes made)
(3,952 real changes made)
(5,116 real changes made)
(14,378 missing values generated)
(4,068 real changes made)
(3,952 real changes made)
(8,020 real changes made)
(9,262 real changes made)
(6,358 missing values generated)
(8,020 real changes made)
(4,068 real changes made)
(6,320 real changes made, 6,320 to missing)
(6,320 missing values generated)
(14,378 missing values generated)
(4,022 real changes made)
(4,036 real changes made)
(4,022 real changes made)
(4,036 real changes made)
(5,090 real changes made)
(14,378 missing values generated)
(4,022 real changes made)
(4,036 real changes made)
(8,058 real changes made)
(9,288 real changes made)
(6,320 missing values generated)
(8,058 real changes made)
(4,022 real changes made)
(6,235 real changes made, 6,235 to missing)
(6,235 missing values generated)
(14,378 missing values generated)
(4,132 real changes made)
(4,011 real changes made)
(4,132 real changes made)
(4,011 real changes made)
(5,115 real changes made)
(14,378 missing values generated)
(4,132 real changes made)
(4,011 real changes made)
(8,143 real changes made)
(9,263 real changes made)
(6,235 missing values generated)
(8,143 real changes made)
(4,132 real changes made)
(6,298 real changes made, 6,298 to missing)
(6,298 missing values generated)
(14,378 missing values generated)
(4,115 real changes made)
(3,965 real changes made)
(4,115 real changes made)
(3,965 real changes made)
(5,084 real changes made)
(14,378 missing values generated)
(4,115 real changes made)
(3,965 real changes made)
(8,080 real changes made)
(9,294 real changes made)
(6,298 missing values generated)
(8,080 real changes made)
(4,115 real changes made)
(6,336 real changes made, 6,336 to missing)
(6,336 missing values generated)
(14,378 missing values generated)
(4,051 real changes made)
(3,991 real changes made)
(4,051 real changes made)
(3,991 real changes made)
(5,077 real changes made)
(14,378 missing values generated)
(4,051 real changes made)
(3,991 real changes made)
(8,042 real changes made)
(9,301 real changes made)
(6,336 missing values generated)
(8,042 real changes made)
(4,051 real changes made)
(6,303 real changes made, 6,303 to missing)
(6,303 missing values generated)
(14,378 missing values generated)
(4,102 real changes made)
(3,973 real changes made)
(4,102 real changes made)
(3,973 real changes made)
(5,076 real changes made)
(14,378 missing values generated)
(4,102 real changes made)
(3,973 real changes made)
(8,075 real changes made)
(9,302 real changes made)
(6,303 missing values generated)
(8,075 real changes made)
(4,102 real changes made)
(6,369 real changes made, 6,369 to missing)
(6,369 missing values generated)
(14,378 missing values generated)
(3,992 real changes made)
(4,017 real changes made)
(3,992 real changes made)
(4,017 real changes made)
(5,069 real changes made)
(14,378 missing values generated)
(3,992 real changes made)
(4,017 real changes made)
(8,009 real changes made)
(9,309 real changes made)
(6,369 missing values generated)
(8,009 real changes made)
(3,992 real changes made)
(6,326 real changes made, 6,326 to missing)
(6,326 missing values generated)
(14,378 missing values generated)
(4,076 real changes made)
(3,976 real changes made)
(4,076 real changes made)
(3,976 real changes made)
(5,057 real changes made)
(14,378 missing values generated)
(4,076 real changes made)
(3,976 real changes made)
(8,052 real changes made)
(9,321 real changes made)
(6,326 missing values generated)
(8,052 real changes made)
(4,076 real changes made)
(6,343 real changes made, 6,343 to missing)
(6,343 missing values generated)
(14,378 missing values generated)
(4,073 real changes made)
(3,962 real changes made)
(4,073 real changes made)
(3,962 real changes made)
(5,123 real changes made)
(14,378 missing values generated)
(4,073 real changes made)
(3,962 real changes made)
(8,035 real changes made)
(9,255 real changes made)
(6,343 missing values generated)
(8,035 real changes made)
(4,073 real changes made)
(6,336 real changes made, 6,336 to missing)
(6,336 missing values generated)
(14,378 missing values generated)
(4,092 real changes made)
(3,950 real changes made)
(4,092 real changes made)
(3,950 real changes made)
(5,073 real changes made)
(14,378 missing values generated)
(4,092 real changes made)
(3,950 real changes made)
(8,042 real changes made)
(9,305 real changes made)
(6,336 missing values generated)
(8,042 real changes made)
(4,092 real changes made)
(6,299 real changes made, 6,299 to missing)
(6,299 missing values generated)
(14,378 missing values generated)
(4,067 real changes made)
(4,012 real changes made)
(4,067 real changes made)
(4,012 real changes made)
(5,146 real changes made)
(14,378 missing values generated)
(4,067 real changes made)
(4,012 real changes made)
(8,079 real changes made)
(9,232 real changes made)
(6,299 missing values generated)
(8,079 real changes made)
(4,067 real changes made)
(6,422 real changes made, 6,422 to missing)
(6,422 missing values generated)
(14,378 missing values generated)
(4,038 real changes made)
(3,918 real changes made)
(4,038 real changes made)
(3,918 real changes made)
(4,999 real changes made)
(14,378 missing values generated)
(4,038 real changes made)
(3,918 real changes made)
(7,956 real changes made)
(9,379 real changes made)
(6,422 missing values generated)
(7,956 real changes made)
(4,038 real changes made)
(6,375 real changes made, 6,375 to missing)
(6,375 missing values generated)
(14,378 missing values generated)
(4,004 real changes made)
(3,999 real changes made)
(4,004 real changes made)
(3,999 real changes made)
(5,059 real changes made)
(14,378 missing values generated)
(4,004 real changes made)
(3,999 real changes made)
(8,003 real changes made)
(9,319 real changes made)
(6,375 missing values generated)
(8,003 real changes made)
(4,004 real changes made)
(6,349 real changes made, 6,349 to missing)
(6,349 missing values generated)
(14,378 missing values generated)
(4,012 real changes made)
(4,017 real changes made)
(4,012 real changes made)
(4,017 real changes made)
(5,075 real changes made)
(14,378 missing values generated)
(4,012 real changes made)
(4,017 real changes made)
(8,029 real changes made)
(9,303 real changes made)
(6,349 missing values generated)
(8,029 real changes made)
(4,012 real changes made)
(6,344 real changes made, 6,344 to missing)
(6,344 missing values generated)
(14,378 missing values generated)
(4,075 real changes made)
(3,959 real changes made)
(4,075 real changes made)
(3,959 real changes made)
(5,042 real changes made)
(14,378 missing values generated)
(4,075 real changes made)
(3,959 real changes made)
(8,034 real changes made)
(9,336 real changes made)
(6,344 missing values generated)
(8,034 real changes made)
(4,075 real changes made)
(6,421 real changes made, 6,421 to missing)
(6,421 missing values generated)
(14,378 missing values generated)
(3,967 real changes made)
(3,990 real changes made)
(3,967 real changes made)
(3,990 real changes made)
(5,059 real changes made)
(14,378 missing values generated)
(3,967 real changes made)
(3,990 real changes made)
(7,957 real changes made)
(9,319 real changes made)
(6,421 missing values generated)
(7,957 real changes made)
(3,967 real changes made)
(6,286 real changes made, 6,286 to missing)
(6,286 missing values generated)
(14,378 missing values generated)
(4,018 real changes made)
(4,074 real changes made)
(4,018 real changes made)
(4,074 real changes made)
(5,135 real changes made)
(14,378 missing values generated)
(4,018 real changes made)
(4,074 real changes made)
(8,092 real changes made)
(9,243 real changes made)
(6,286 missing values generated)
(8,092 real changes made)
(4,018 real changes made)
(6,241 real changes made, 6,241 to missing)
(6,241 missing values generated)
(14,378 missing values generated)
(4,141 real changes made)
(3,996 real changes made)
(4,141 real changes made)
(3,996 real changes made)
(5,125 real changes made)
(14,378 missing values generated)
(4,141 real changes made)
(3,996 real changes made)
(8,137 real changes made)
(9,253 real changes made)
(6,241 missing values generated)
(8,137 real changes made)
(4,141 real changes made)
(6,254 real changes made, 6,254 to missing)
(6,254 missing values generated)
(14,378 missing values generated)
(4,095 real changes made)
(4,029 real changes made)
(4,095 real changes made)
(4,029 real changes made)
(5,138 real changes made)
(14,378 missing values generated)
(4,095 real changes made)
(4,029 real changes made)
(8,124 real changes made)
(9,240 real changes made)
(6,254 missing values generated)
(8,124 real changes made)
(4,095 real changes made)
(6,256 real changes made, 6,256 to missing)
(6,256 missing values generated)
(14,378 missing values generated)
(4,113 real changes made)
(4,009 real changes made)
(4,113 real changes made)
(4,009 real changes made)
(5,128 real changes made)
(14,378 missing values generated)
(4,113 real changes made)
(4,009 real changes made)
(8,122 real changes made)
(9,250 real changes made)
(6,256 missing values generated)
(8,122 real changes made)
(4,113 real changes made)
(6,254 real changes made, 6,254 to missing)
(6,254 missing values generated)
(14,378 missing values generated)
(4,133 real changes made)
(3,991 real changes made)
(4,133 real changes made)
(3,991 real changes made)
(5,121 real changes made)
(14,378 missing values generated)
(4,133 real changes made)
(3,991 real changes made)
(8,124 real changes made)
(9,257 real changes made)
(6,254 missing values generated)
(8,124 real changes made)
(4,133 real changes made)
(6,346 real changes made, 6,346 to missing)
(6,346 missing values generated)
(14,378 missing values generated)
(4,013 real changes made)
(4,019 real changes made)
(4,013 real changes made)
(4,019 real changes made)
(5,067 real changes made)
(14,378 missing values generated)
(4,013 real changes made)
(4,019 real changes made)
(8,032 real changes made)
(9,311 real changes made)
(6,346 missing values generated)
(8,032 real changes made)
(4,013 real changes made)
(6,291 real changes made, 6,291 to missing)
(6,291 missing values generated)
(14,378 missing values generated)
(4,014 real changes made)
(4,073 real changes made)
(4,014 real changes made)
(4,073 real changes made)
(5,191 real changes made)
(14,378 missing values generated)
(4,014 real changes made)
(4,073 real changes made)
(8,087 real changes made)
(9,187 real changes made)
(6,291 missing values generated)
(8,087 real changes made)
(4,014 real changes made)

. 
. gen covid_date_string=string(covid_date, "%td") 

. gen covid_month=substr( covid_date_string ,3,7)

. 
. gen baseline_egfr=.
(14,378 missing values generated)

. local month_year "feb2020 mar2020 apr2020 may2020 jun2020 jul2020 aug2020 sep2020 oct2020 nov2020 dec2020 jan2021 feb2021 mar2021 apr2021 may2021 jun2021 jul2021 aug2021 sep2021 oct2021 nov2021 dec2021 jan2022"

. foreach x of  local month_year  {
  2. replace baseline_egfr=egfr_baseline_creatinine_`x' if  covid_month=="`x'"
  3. drop if baseline_egfr <15
  4. drop egfr_baseline_creatinine_`x'
  5. }
(354 real changes made)
(0 observations deleted)
(351 real changes made)
(0 observations deleted)
(368 real changes made)
(0 observations deleted)
(377 real changes made)
(0 observations deleted)
(377 real changes made)
(0 observations deleted)
(361 real changes made)
(0 observations deleted)
(359 real changes made)
(0 observations deleted)
(336 real changes made)
(0 observations deleted)
(374 real changes made)
(0 observations deleted)
(339 real changes made)
(0 observations deleted)
(356 real changes made)
(0 observations deleted)
(340 real changes made)
(0 observations deleted)
(305 real changes made)
(0 observations deleted)
(329 real changes made)
(0 observations deleted)
(329 real changes made)
(0 observations deleted)
(328 real changes made)
(0 observations deleted)
(288 real changes made)
(0 observations deleted)
(321 real changes made)
(0 observations deleted)
(279 real changes made)
(0 observations deleted)
(299 real changes made)
(0 observations deleted)
(316 real changes made)
(0 observations deleted)
(286 real changes made)
(0 observations deleted)
(257 real changes made)
(0 observations deleted)
(303 real changes made)
(0 observations deleted)

. drop baseline_egfr

. drop covid_month

. drop covid_date_string

. drop age

. 
. * COVID-19 death
. drop if deceased==1
(1,482 observations deleted)

. drop deceased

. 
. **Covariates
. * IMD
. rename imd imd_o

. egen imd = cut(imd_o), group(5) icodes

. replace imd = imd + 1
(12,896 real changes made)

. drop imd_o

. recode imd 5=1 4=2 3=3 2=4 1=5 .=.
(10349 changes made to imd)

. label define imd 1 "1 least deprived" 2 "2" 3 "3" 4 "4" 5 "5 most deprived" 

. label values imd imd

. label var imd "Index of Multiple Deprivation"

. noi di "DROPPING IF NO IMD" 
DROPPING IF NO IMD

. drop if imd>=.
(0 observations deleted)

. 
. **Drop disaggregated krt_outcome variables
. drop krt_outcome_primary_care

. drop krt_outcome_icd_10

. drop krt_outcome_opcs_4

. 
. **Create index date (28 days after covid_date)
. gen index_date = covid_date + 28

. 
end of do-file

. browse

