------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\lsh1703468\Documents\repos\logs/cox_esrd_2017.log
  log type:  text
 opened on:  28 Dec 2022, 11:44:00

. use ./output/analysis_2017.dta

. 
. stset exit_date, fail(esrd_date) origin(index_date) id(patient_id) scale(365.25)

Survival-time data settings

           ID variable: patient_id
         Failure event: esrd_date!=0 & esrd_date<.
Observed time interval: (exit_date[_n-1], exit_date]
     Exit on or before: failure
     Time for analysis: (time-origin)/365.25
                Origin: time index_date

--------------------------------------------------------------------------
     26,270  total observations
        126  observations end on or before enter()
         36  observations begin on or after (first) failure
--------------------------------------------------------------------------
     26,108  observations remaining, representing
     25,866  subjects
      2,646  failures in single-failure-per-subject data
 43,024.726  total analysis time at risk and under observation
                                                At risk from t =         0
                                     Earliest observed entry t =         0
                                          Last observed exit t =  5.689254

. 
end of do-file

. browse

. do "C:\Users\LSH170~1\AppData\Local\Temp\STD1a44_000000.tmp"

. foreach exposure of varlist     case                    ///
>                                                         covid_severity  ///
>                                                         covid_aki               ///
>                                                         covid_vax               ///
>                                                         calendar_period {
  2.         tab _d `exposure', col chi
  3.         strate `exposure'
  4.         stcox i.`exposure' i.sex age1 age2 age3, vce(cluster practice_id) strata(set_id)
  5.         quietly stcox i.`exposure' i.sex age1 age2 age3, strata(set_id)
  6.         est store A
  7.         quietly stcox i.sex age1 age2 age3, strata(set_id)
  8.         est store B
  9.         lrtest B A
 10.         stcox i.`exposure' i.sex i.ethnicity i.imd i.region i.urban i.bmi i.smoking age1 age2 age3, vce(cluster practice_id) strata(set_id)
 11.         quietly stcox i.`exposure' i.sex i.ethnicity i.imd i.region i.urban i.bmi i.smoking age1 age2 age3, strata(set_id)
 12.         est store A
 13.         quietly stcox i.sex i.ethnicity i.imd i.region i.urban i.bmi i.smoking age1 age2 age3, strata(set_id)
 14.         est store B
 15.         lrtest B A
 16.         stcox i.`exposure' i.sex i.ethnicity i.imd i.region i.urban i.bmi i.cardiovascular i.diabetes i.hypertension i.immunosuppressed i.non_haem_cancer i.smoking age1 age2 age3, vce(cluster practice_id) strata(set_id)
 17.         quietly stcox i.`exposure' i.sex i.ethnicity i.imd i.region i.urban i.bmi i.cardiovascular i.diabetes i.hypertension i.immunosuppressed i.non_haem_cancer i.smoking age1 age2 age3, strata(set_id)
 18.         est store A
 19.         quietly stcox i.sex i.ethnicity i.imd i.region i.urban i.bmi i.cardiovascular i.diabetes i.hypertension i.immunosuppressed i.non_haem_cancer i.smoking age1 age2 age3, strata(set_id)
 20.         est store B
 21.         lrtest B A
 22.         }

+-------------------+
| Key               |
|-------------------|
|     frequency     |
| column percentage |
+-------------------+

      1 if |
failure; 0 |
        if |         case
  censored | Comparato   COVID-19 |     Total
-----------+----------------------+----------
         0 |    16,738      6,724 |    23,462 
           |     89.85      89.91 |     89.87 
-----------+----------------------+----------
         1 |     1,891        755 |     2,646 
           |     10.15      10.09 |     10.13 
-----------+----------------------+----------
     Total |    18,629      7,479 |    26,108 
           |    100.00     100.00 |    100.00 

          Pearson chi2(1) =   0.0183   Pr = 0.892

        Failure _d: esrd_date
  Analysis time _t: (exit_date-origin)/365.25
            Origin: time index_date
       ID variable: patient_id

Estimated failure rates
Number of records = 26108

  +---------------------------------------------------------------------------+
  |                    case      D         Y       Rate      Lower      Upper |
  |---------------------------------------------------------------------------|
  | Comparator (historical)   1891   3.1e+04   0.061750   0.059029   0.064597 |
  |                COVID-19    755   1.2e+04   0.060881   0.056690   0.065382 |
  +---------------------------------------------------------------------------+
   Notes: Rate = D/Y = failures/person-time.
          Lower and Upper are bounds of 95% confidence intervals.


        Failure _d: esrd_date
  Analysis time _t: (exit_date-origin)/365.25
            Origin: time index_date
       ID variable: patient_id

Iteration 0:   log pseudolikelihood =  -2865.187
Iteration 1:   log pseudolikelihood = -2860.5181
Iteration 2:   log pseudolikelihood = -2860.5177
Refining estimates:
Iteration 0:   log pseudolikelihood = -2860.5177

Stratified Cox regression with Breslow method for ties
Strata variable: set_id

No. of subjects =      25,866                           Number of obs = 26,108
No. of failures =       2,646
Time at risk    = 43,024.7255
                                                        Wald chi2(4)  =  33.78
Log pseudolikelihood = -2860.5177                       Prob > chi2   = 0.0000

                           (Std. err. adjusted for 39 clusters in practice_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. ratio   std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
        case |
   COVID-19  |   1.008911   .0395615     0.23   0.821     .9342762    1.089507
             |
         sex |
       Male  |          1  (omitted)
        age1 |   1.018515   .0047984     3.89   0.000     1.009154    1.027963
        age2 |   .9626184   .0132789    -2.76   0.006      .936941    .9889996
        age3 |   1.075515   .0421751     1.86   0.063     .9959495    1.161436
------------------------------------------------------------------------------

Likelihood-ratio test
Assumption: B nested within A

 LR chi2(1) =   0.03
Prob > chi2 = 0.8525

        Failure _d: esrd_date
  Analysis time _t: (exit_date-origin)/365.25
            Origin: time index_date
       ID variable: patient_id

Iteration 0:   log pseudolikelihood = -51.306442
Iteration 1:   log pseudolikelihood = -32.548236
Iteration 2:   log pseudolikelihood = -28.844228
Iteration 3:   log pseudolikelihood = -27.798299
Iteration 4:   log pseudolikelihood = -27.678944
Iteration 5:   log pseudolikelihood = -27.676494
Iteration 6:   log pseudolikelihood = -27.676492
Refining estimates:
Iteration 0:   log pseudolikelihood = -27.676492

Stratified Cox regression with no ties
Strata variable: set_id

No. of subjects =      3,197                          Number of obs =    3,203
No. of failures =        327
Time at risk    = 5,328.1752
                                                      Wald chi2(19) = 78105.53
Log pseudolikelihood = -27.676492                     Prob > chi2   =   0.0000

                                        (Std. err. adjusted for 34 clusters in practice_id)
-------------------------------------------------------------------------------------------
                          |               Robust
                       _t | Haz. ratio   std. err.      z    P>|z|     [95% conf. interval]
--------------------------+----------------------------------------------------------------
                     case |
                COVID-19  |   1.771934   .6582544     1.54   0.124       .85553    3.669946
                          |
                      sex |
                    Male  |          1  (omitted)
                          |
                ethnicity |
             South Asian  |   .3757277   .3749156    -0.98   0.327      .053151    2.656042
                   Black  |   .3462692   .3064378    -1.20   0.231     .0611119    1.962012
                   Mixed  |   16.49981   29.23207     1.58   0.114     .5121987    531.5199
                   Other  |   1.211631   .8491373     0.27   0.784     .3067817     4.78532
                          |
                      imd |
                       2  |    1.65173   1.285041     0.65   0.519     .3595068    7.588764
                       3  |   .2211151   .2613928    -1.28   0.202     .0217954    2.243223
                       4  |   10.09561   13.35562     1.75   0.081     .7552072     134.958
        5 Least deprived  |   .5807776   .4551619    -0.69   0.488      .125001    2.698398
                          |
                   region |
                    East  |   .1962169   .4132869    -0.77   0.439     .0031613    12.17871
                  London  |   .0283029   .0172317    -5.86   0.000      .008582    .0933405
              North East  |   .0177422   .0221285    -3.23   0.001     .0015395    .2044782
              North West  |   .1470506   .0877746    -3.21   0.001      .045644    .4737501
              South East  |   3.237718   1.871236     2.03   0.042     1.043008    10.05056
              South West  |   .0611759   .0449959    -3.80   0.000     .0144713    .2586149
           West Midlands  |   .0087281   .0121161    -3.42   0.001     .0005745    .1325977
Yorkshire and The Humber  |   .1295821   .0802646    -3.30   0.001     .0384858    .4363037
                          |
                    urban |
                   Urban  |   .6284797   .3624803    -0.81   0.421     .2029338    1.946382
                          |
                      bmi |
      Normal (18.5-24.9)  |   42.25818   121.4968     1.30   0.193     .1508745    11836.02
    Overweight (25-29.9)  |   101.5409   306.3828     1.53   0.126     .2743352    37583.77
       Obese I (30-34.9)  |   30.81038   117.3948     0.90   0.368     .0175961    53948.14
      Obese II (35-39.9)  |   14.58302   51.00548     0.77   0.444     .0153706     13835.8
         Obese III (40+)  |   130.3453   349.9857     1.81   0.070     .6754022    25155.22
                          |
                  smoking |
   Current/former smoker  |    1.06406   .5381274     0.12   0.902     .3949002    2.867111
                     age1 |    .812069   .0381756    -4.43   0.000     .7405897    .8904472
                     age2 |   2.125346   .3119293     5.14   0.000      1.59405    2.833723
                     age3 |   .0821616   .0386695    -5.31   0.000     .0326625    .2066754
-------------------------------------------------------------------------------------------

Likelihood-ratio test
Assumption: B nested within A

 LR chi2(1) =   0.65
Prob > chi2 = 0.4185

        Failure _d: esrd_date
  Analysis time _t: (exit_date-origin)/365.25
            Origin: time index_date
       ID variable: patient_id

Iteration 0:   log pseudolikelihood = -51.306442
Iteration 1:   log pseudolikelihood = -27.577689
Iteration 2:   log pseudolikelihood = -20.005275
Iteration 3:   log pseudolikelihood = -15.205097
Iteration 4:   log pseudolikelihood = -11.266429
Iteration 5:   log pseudolikelihood =   -9.57999
Iteration 6:   log pseudolikelihood = -9.4135166
Iteration 7:   log pseudolikelihood = -9.2359153  (backed up)
Iteration 8:   log pseudolikelihood = -9.2104769  (backed up)
Iteration 9:   log pseudolikelihood = -9.1973026  (backed up)
Iteration 10:  log pseudolikelihood =  -9.194002  (backed up)
Iteration 11:  log pseudolikelihood = -9.1923242  (backed up)
Iteration 12:  log pseudolikelihood = -9.1921179  (backed up)
flat region resulting in a missing likelihood
r(430);

end of do-file

r(430);

. do "C:\Users\LSH170~1\AppData\Local\Temp\STD1a44_000000.tmp"

. sysdir set PLUS ./analysis/adofiles

. sysdir set PERSONAL ./analysis/adofiles

. pwd
C:\Users\lsh1703468\Documents\repos

. 
. cap log close
