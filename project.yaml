version: "3.0"

expectations:
  population_size: 50000

actions:

# Extract data required for matching for covid (all STPs)
  extract_covid_matching:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_covid_matching
    outputs:
      highly_sensitive:
        cohort: output/input_covid_matching.csv

#Data management for covid_matching for matching with 2017 general population
  clean_covid_matching_2017:
    run: stata-mp:latest analysis/covid_matching_2017.do
    needs: [extract_covid_matching]
    outputs:
      highly_sensitive:
        analysis_dataset: output/covid_matching_2017.csv
      moderately_sensitive:
        log: logs/covid_matching_2017.log

#Extract data required for matching for 2017 (all STPs)
  extract_2017_matching:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_2017_matching
    outputs:
      highly_sensitive:
        cohort: output/input_2017_matching.csv

#Data management for 2017_matching
  clean_2017_matching:
    run: stata-mp:latest analysis/2017_matching.do
    needs: [extract_2017_matching, clean_covid_matching_2017]
    outputs:
      highly_sensitive:
        analysis_dataset: output/2017_matching.csv
      moderately_sensitive:
        log: logs/2017_matching.log

# Split covid_matching_2017 and 2017_matching by STP
  split_stps_2017:
    run: stata-mp:latest analysis/split_stps_2017.do
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching]
    outputs:
      highly_sensitive:
        covid_stp5: output/input_covid_matching_2017_stp5.csv
        covid_stp6: output/input_covid_matching_2017_stp6.csv
        covid_stp7: output/input_covid_matching_2017_stp7.csv
        covid_stp8: output/input_covid_matching_2017_stp8.csv
        covid_stp9: output/input_covid_matching_2017_stp9.csv
        covid_stp10: output/input_covid_matching_2017_stp10.csv
        covid_stp12: output/input_covid_matching_2017_stp12.csv
        covid_stp13: output/input_covid_matching_2017_stp13.csv
        covid_stp14: output/input_covid_matching_2017_stp14.csv
        covid_stp15: output/input_covid_matching_2017_stp15.csv
        covid_stp16: output/input_covid_matching_2017_stp16.csv
        covid_stp17: output/input_covid_matching_2017_stp17.csv
        covid_stp20: output/input_covid_matching_2017_stp20.csv
        covid_stp21: output/input_covid_matching_2017_stp21.csv
        covid_stp22: output/input_covid_matching_2017_stp22.csv
        covid_stp23: output/input_covid_matching_2017_stp23.csv
        covid_stp24: output/input_covid_matching_2017_stp24.csv
        covid_stp25: output/input_covid_matching_2017_stp25.csv
        covid_stp26: output/input_covid_matching_2017_stp26.csv
        covid_stp27: output/input_covid_matching_2017_stp27.csv
        covid_stp29: output/input_covid_matching_2017_stp29.csv
        covid_stp33: output/input_covid_matching_2017_stp33.csv
        covid_stp35: output/input_covid_matching_2017_stp35.csv
        covid_stp36: output/input_covid_matching_2017_stp36.csv
        covid_stp37: output/input_covid_matching_2017_stp37.csv
        covid_stp40: output/input_covid_matching_2017_stp40.csv
        covid_stp41: output/input_covid_matching_2017_stp41.csv
        covid_stp42: output/input_covid_matching_2017_stp42.csv
        covid_stp43: output/input_covid_matching_2017_stp43.csv
        covid_stp44: output/input_covid_matching_2017_stp44.csv
        covid_stp49: output/input_covid_matching_2017_stp49.csv
        2017_stp5: output/input_2017_matching_stp5.csv
        2017_stp6: output/input_2017_matching_stp6.csv
        2017_stp7: output/input_2017_matching_stp7.csv
        2017_stp8: output/input_2017_matching_stp8.csv
        2017_stp9: output/input_2017_matching_stp9.csv
        2017_stp10: output/input_2017_matching_stp10.csv
        2017_stp12: output/input_2017_matching_stp12.csv
        2017_stp13: output/input_2017_matching_stp13.csv
        2017_stp14: output/input_2017_matching_stp14.csv
        2017_stp15: output/input_2017_matching_stp15.csv
        2017_stp16: output/input_2017_matching_stp16.csv
        2017_stp17: output/input_2017_matching_stp17.csv
        2017_stp20: output/input_2017_matching_stp20.csv
        2017_stp21: output/input_2017_matching_stp21.csv
        2017_stp22: output/input_2017_matching_stp22.csv
        2017_stp23: output/input_2017_matching_stp23.csv
        2017_stp24: output/input_2017_matching_stp24.csv
        2017_stp25: output/input_2017_matching_stp25.csv
        2017_stp26: output/input_2017_matching_stp26.csv
        2017_stp27: output/input_2017_matching_stp27.csv
        2017_stp29: output/input_2017_matching_stp29.csv
        2017_stp33: output/input_2017_matching_stp33.csv
        2017_stp35: output/input_2017_matching_stp35.csv
        2017_stp36: output/input_2017_matching_stp36.csv
        2017_stp37: output/input_2017_matching_stp37.csv
        2017_stp40: output/input_2017_matching_stp40.csv
        2017_stp41: output/input_2017_matching_stp41.csv
        2017_stp42: output/input_2017_matching_stp42.csv
        2017_stp43: output/input_2017_matching_stp43.csv
        2017_stp44: output/input_2017_matching_stp44.csv
        2017_stp49: output/input_2017_matching_stp49.csv
      moderately_sensitive:
        log: logs/split_stps_2017.log

  match_2017_stp5:
    run: python:latest python analysis/match_2017_stp5.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp5: output/matching_report_2017_stp5.txt
      highly_sensitive:
        matched_matches_stp5: output/matched_matches_2017_stp5.csv
        matched_cases_stp5: output/matched_cases_2017_stp5.csv
        matched_all_stp5: output/matched_combined_2017_stp5.csv

  match_2017_stp6:
    run: python:latest python analysis/match_2017_stp6.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp6: output/matching_report_2017_stp6.txt
      highly_sensitive:
        matched_matches_stp6: output/matched_matches_2017_stp6.csv
        matched_cases_stp6: output/matched_cases_2017_stp6.csv
        matched_all_stp6: output/matched_combined_2017_stp6.csv

  match_2017_stp7:
    run: python:latest python analysis/match_2017_stp7.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp7: output/matching_report_2017_stp7.txt
      highly_sensitive:
        matched_matches_stp7: output/matched_matches_2017_stp7.csv
        matched_cases_stp7: output/matched_cases_2017_stp7.csv
        matched_all_stp7: output/matched_combined_2017_stp7.csv

  match_2017_stp8:
    run: python:latest python analysis/match_2017_stp8.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp8: output/matching_report_2017_stp8.txt
      highly_sensitive:
        matched_matches_stp8: output/matched_matches_2017_stp8.csv
        matched_cases_stp8: output/matched_cases_2017_stp8.csv
        matched_all_stp8: output/matched_combined_2017_stp8.csv

  match_2017_stp9:
    run: python:latest python analysis/match_2017_stp9.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp9: output/matching_report_2017_stp9.txt
      highly_sensitive:
        matched_matches_stp9: output/matched_matches_2017_stp9.csv
        matched_cases_stp9: output/matched_cases_2017_stp9.csv
        matched_all_stp9: output/matched_combined_2017_stp9.csv

  match_2017_stp10:
    run: python:latest python analysis/match_2017_stp10.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp10: output/matching_report_2017_stp10.txt
      highly_sensitive:
        matched_matches_stp10: output/matched_matches_2017_stp10.csv
        matched_cases_stp10: output/matched_cases_2017_stp10.csv
        matched_all_stp10: output/matched_combined_2017_stp10.csv

  match_2017_stp12:
    run: python:latest python analysis/match_2017_stp12.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp12: output/matching_report_2017_stp12.txt
      highly_sensitive:
        matched_matches_stp12: output/matched_matches_2017_stp12.csv
        matched_cases_stp12: output/matched_cases_2017_stp12.csv
        matched_all_stp12: output/matched_combined_2017_stp12.csv

  match_2017_stp13:
    run: python:latest python analysis/match_2017_stp13.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp13: output/matching_report_2017_stp13.txt
      highly_sensitive:
        matched_matches_stp13: output/matched_matches_2017_stp13.csv
        matched_cases_stp13: output/matched_cases_2017_stp13.csv
        matched_all_stp13: output/matched_combined_2017_stp13.csv

  match_2017_stp14:
    run: python:latest python analysis/match_2017_stp14.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp14: output/matching_report_2017_stp14.txt
      highly_sensitive:
        matched_matches_stp14: output/matched_matches_2017_stp14.csv
        matched_cases_stp14: output/matched_cases_2017_stp14.csv
        matched_all_stp14: output/matched_combined_2017_stp14.csv

  match_2017_stp15:
    run: python:latest python analysis/match_2017_stp15.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp15: output/matching_report_2017_stp15.txt
      highly_sensitive:
        matched_matches_stp15: output/matched_matches_2017_stp15.csv
        matched_cases_stp15: output/matched_cases_2017_stp15.csv
        matched_all_stp15: output/matched_combined_2017_stp15.csv

  match_2017_stp16:
    run: python:latest python analysis/match_2017_stp16.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp16: output/matching_report_2017_stp16.txt
      highly_sensitive:
        matched_matches_stp16: output/matched_matches_2017_stp16.csv
        matched_cases_stp16: output/matched_cases_2017_stp16.csv
        matched_all_stp16: output/matched_combined_2017_stp16.csv

  match_2017_stp17:
    run: python:latest python analysis/match_2017_stp17.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp17: output/matching_report_2017_stp17.txt
      highly_sensitive:
        matched_matches_stp17: output/matched_matches_2017_stp17.csv
        matched_cases_stp17: output/matched_cases_2017_stp17.csv
        matched_all_stp17: output/matched_combined_2017_stp17.csv

  match_2017_stp20:
    run: python:latest python analysis/match_2017_stp20.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp20: output/matching_report_2017_stp20.txt
      highly_sensitive:
        matched_matches_stp20: output/matched_matches_2017_stp20.csv
        matched_cases_stp20: output/matched_cases_2017_stp20.csv
        matched_all_stp20: output/matched_combined_2017_stp20.csv

  match_2017_stp21:
    run: python:latest python analysis/match_2017_stp21.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp21: output/matching_report_2017_stp21.txt
      highly_sensitive:
        matched_matches_stp21: output/matched_matches_2017_stp21.csv
        matched_cases_stp21: output/matched_cases_2017_stp21.csv
        matched_all_stp21: output/matched_combined_2017_stp21.csv

  match_2017_stp22:
    run: python:latest python analysis/match_2017_stp22.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp22: output/matching_report_2017_stp22.txt
      highly_sensitive:
        matched_matches_stp22: output/matched_matches_2017_stp22.csv
        matched_cases_stp22: output/matched_cases_2017_stp22.csv
        matched_all_stp22: output/matched_combined_2017_stp22.csv

  match_2017_stp23:
    run: python:latest python analysis/match_2017_stp23.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp23: output/matching_report_2017_stp23.txt
      highly_sensitive:
        matched_matches_stp23: output/matched_matches_2017_stp23.csv
        matched_cases_stp23: output/matched_cases_2017_stp23.csv
        matched_all_stp23: output/matched_combined_2017_stp23.csv

  match_2017_stp24:
    run: python:latest python analysis/match_2017_stp24.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp24: output/matching_report_2017_stp24.txt
      highly_sensitive:
        matched_matches_stp24: output/matched_matches_2017_stp24.csv
        matched_cases_stp24: output/matched_cases_2017_stp24.csv
        matched_all_stp24: output/matched_combined_2017_stp24.csv

  match_2017_stp25:
    run: python:latest python analysis/match_2017_stp25.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp25: output/matching_report_2017_stp25.txt
      highly_sensitive:
        matched_matches_stp25: output/matched_matches_2017_stp25.csv
        matched_cases_stp25: output/matched_cases_2017_stp25.csv
        matched_all_stp25: output/matched_combined_2017_stp25.csv

  match_2017_stp26:
    run: python:latest python analysis/match_2017_stp26.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp26: output/matching_report_2017_stp26.txt
      highly_sensitive:
        matched_matches_stp26: output/matched_matches_2017_stp26.csv
        matched_cases_stp26: output/matched_cases_2017_stp26.csv
        matched_all_stp26: output/matched_combined_2017_stp26.csv

  match_2017_stp27:
    run: python:latest python analysis/match_2017_stp27.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp27: output/matching_report_2017_stp27.txt
      highly_sensitive:
        matched_matches_stp27: output/matched_matches_2017_stp27.csv
        matched_cases_stp27: output/matched_cases_2017_stp27.csv
        matched_all_stp27: output/matched_combined_2017_stp27.csv

  match_2017_stp29:
    run: python:latest python analysis/match_2017_stp29.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp29: output/matching_report_2017_stp29.txt
      highly_sensitive:
        matched_matches_stp29: output/matched_matches_2017_stp29.csv
        matched_cases_stp29: output/matched_cases_2017_stp29.csv
        matched_all_stp29: output/matched_combined_2017_stp29.csv

  match_2017_stp33:
    run: python:latest python analysis/match_2017_stp33.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp33: output/matching_report_2017_stp33.txt
      highly_sensitive:
        matched_matches_stp33: output/matched_matches_2017_stp33.csv
        matched_cases_stp33: output/matched_cases_2017_stp33.csv
        matched_all_stp33: output/matched_combined_2017_stp33.csv

  match_2017_stp35:
    run: python:latest python analysis/match_2017_stp35.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp35: output/matching_report_2017_stp35.txt
      highly_sensitive:
        matched_matches_stp35: output/matched_matches_2017_stp35.csv
        matched_cases_stp35: output/matched_cases_2017_stp35.csv
        matched_all_stp35: output/matched_combined_2017_stp35.csv

  match_2017_stp36:
    run: python:latest python analysis/match_2017_stp36.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp36: output/matching_report_2017_stp36.txt
      highly_sensitive:
        matched_matches_stp36: output/matched_matches_2017_stp36.csv
        matched_cases_stp36: output/matched_cases_2017_stp36.csv
        matched_all_stp36: output/matched_combined_2017_stp36.csv

  match_2017_stp37:
    run: python:latest python analysis/match_2017_stp37.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp37: output/matching_report_2017_stp37.txt
      highly_sensitive:
        matched_matches_stp37: output/matched_matches_2017_stp37.csv
        matched_cases_stp37: output/matched_cases_2017_stp37.csv
        matched_all_stp37: output/matched_combined_2017_stp37.csv

  match_2017_stp40:
    run: python:latest python analysis/match_2017_stp40.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp40: output/matching_report_2017_stp40.txt
      highly_sensitive:
        matched_matches_stp40: output/matched_matches_2017_stp40.csv
        matched_cases_stp40: output/matched_cases_2017_stp40.csv
        matched_all_stp40: output/matched_combined_2017_stp40.csv

  match_2017_stp41:
    run: python:latest python analysis/match_2017_stp41.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp41: output/matching_report_2017_stp41.txt
      highly_sensitive:
        matched_matches_stp41: output/matched_matches_2017_stp41.csv
        matched_cases_stp41: output/matched_cases_2017_stp41.csv
        matched_all_stp41: output/matched_combined_2017_stp41.csv

  match_2017_stp42:
    run: python:latest python analysis/match_2017_stp42.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp42: output/matching_report_2017_stp42.txt
      highly_sensitive:
        matched_matches_stp42: output/matched_matches_2017_stp42.csv
        matched_cases_stp42: output/matched_cases_2017_stp42.csv
        matched_all_stp42: output/matched_combined_2017_stp42.csv

  match_2017_stp43:
    run: python:latest python analysis/match_2017_stp43.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp43: output/matching_report_2017_stp43.txt
      highly_sensitive:
        matched_matches_stp43: output/matched_matches_2017_stp43.csv
        matched_cases_stp43: output/matched_cases_2017_stp43.csv
        matched_all_stp43: output/matched_combined_2017_stp43.csv

  match_2017_stp44:
    run: python:latest python analysis/match_2017_stp44.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp44: output/matching_report_2017_stp44.txt
      highly_sensitive:
        matched_matches_stp44: output/matched_matches_2017_stp44.csv
        matched_cases_stp44: output/matched_cases_2017_stp44.csv
        matched_all_stp44: output/matched_combined_2017_stp44.csv

  match_2017_stp49:
    run: python:latest python analysis/match_2017_stp49.py
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017]
    outputs:
      moderately_sensitive:
        matching_report_stp49: output/matching_report_2017_stp49.txt
      highly_sensitive:
        matched_matches_stp49: output/matched_matches_2017_stp49.csv
        matched_cases_stp49: output/matched_cases_2017_stp49.csv
        matched_all_stp49: output/matched_combined_2017_stp49.csv

  combine_stps_covid_2017:
    run: stata-mp:latest analysis/combine_stps_covid_2017.do
    needs: [match_2017_stp5, match_2017_stp6, match_2017_stp7, match_2017_stp8, match_2017_stp9,
    match_2017_stp10, match_2017_stp12, match_2017_stp13, match_2017_stp14, match_2017_stp15,
    match_2017_stp16, match_2017_stp17, match_2017_stp20, match_2017_stp21, match_2017_stp22,
    match_2017_stp23, match_2017_stp24, match_2017_stp25, match_2017_stp26, match_2017_stp27,
    match_2017_stp29, match_2017_stp33, match_2017_stp35, match_2017_stp36, match_2017_stp37, 
    match_2017_stp40, match_2017_stp41, match_2017_stp42, match_2017_stp43, match_2017_stp44, 
    match_2017_stp49]
    outputs:
      highly_sensitive:
        matched_cases_combined: output/input_combined_stps_covid_2017.csv
      moderately_sensitive:
        log: logs/combine_stps_covid_2017.log

  combine_stps_matches_2017:
    run: stata-mp:latest analysis/combine_stps_matches_2017.do
    needs: [match_2017_stp5, match_2017_stp6, match_2017_stp7, match_2017_stp8, match_2017_stp9,
    match_2017_stp10, match_2017_stp12, match_2017_stp13, match_2017_stp14, match_2017_stp15,
    match_2017_stp16, match_2017_stp17, match_2017_stp20, match_2017_stp21, match_2017_stp22,
    match_2017_stp23, match_2017_stp24, match_2017_stp25, match_2017_stp26, match_2017_stp27,
    match_2017_stp29, match_2017_stp33, match_2017_stp35, match_2017_stp36, match_2017_stp37, 
    match_2017_stp40, match_2017_stp41, match_2017_stp42, match_2017_stp43, match_2017_stp44, 
    match_2017_stp49]
    outputs:
      highly_sensitive:
        matched_matches_combined: output/input_combined_stps_matches_2017.csv
      moderately_sensitive:
        log: logs/combine_stps_matches_2017.log

  extract_covid_2017_additional:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_covid_2017_additional 
    needs: [combine_stps_covid_2017]
    outputs:
      highly_sensitive:
        cohort: output/input_covid_2017_additional.csv

  extract_2017_additional:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_2017_additional 
    needs: [combine_stps_matches_2017]
    outputs:
      highly_sensitive:
        cohort: output/input_2017_additional.csv

  analysis_2017:
    run: stata-mp:latest analysis/analysis_2017.do
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017, match_2017_stp5, match_2017_stp6, match_2017_stp7, match_2017_stp8, match_2017_stp9, match_2017_stp10, match_2017_stp12, match_2017_stp13, match_2017_stp14, match_2017_stp15, match_2017_stp16, match_2017_stp17, match_2017_stp20, match_2017_stp21, match_2017_stp22, match_2017_stp23, match_2017_stp24, match_2017_stp25, match_2017_stp26, match_2017_stp27, match_2017_stp29, match_2017_stp33, match_2017_stp35, match_2017_stp36, match_2017_stp37, match_2017_stp40, match_2017_stp41, match_2017_stp42, match_2017_stp43, match_2017_stp44, match_2017_stp49, combine_stps_covid_2017, combine_stps_matches_2017, extract_covid_2017_additional, extract_2017_additional]
    outputs:
      highly_sensitive:
        analysis: output/analysis_2017.dta
      moderately_sensitive:
        log: logs/analysis_2017.log

  extract_covid_hospitalised:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_covid_hospitalised
    outputs:
      highly_sensitive:
        cohort: output/input_covid_hospitalised.csv

  extract_pneumonia_hospitalised:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_pneumonia_hospitalised
    outputs:
      highly_sensitive:
        cohort: output/input_pneumonia_hospitalised.csv

  analysis_hospitalised:
    run: stata-mp:latest analysis/analysis_hospitalised.do
    needs: [extract_covid_hospitalised, extract_pneumonia_hospitalised]
    outputs:
      highly_sensitive:
        analysis: output/analysis_hospitalised.dta
      moderately_sensitive:
        log: logs/analysis_hospitalised.log

#Data management for covid_matching for matching with 2020 general population
  clean_covid_matching_2020:
    run: stata-mp:latest analysis/covid_matching_2020.do
    needs: [extract_asthma_matching_2020]
    outputs:
      highly_sensitive:
        analysis_dataset: output/covid_matching_2020.csv
      moderately_sensitive:
        log: logs/covid_matching_2020.log

#Extract data required for matching for 2020 (all STPs)
  extract_2020_matching:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_2020_matching
    outputs:
      highly_sensitive:
        cohort: output/input_2020_matching.csv

#Data management for 2020_matching
  clean_2020_matching:
    run: stata-mp:latest analysis/2020_matching.do
    needs: [extract_2020_matching_asthma, clean_covid_matching_2020]
    outputs:
      highly_sensitive:
        analysis_dataset: output/2020_matching.csv
      moderately_sensitive:
        log: logs/2020_matching.log

# Split covid_matching_2020 and 2020_matching by STP
  split_stps_2020:
    run: stata-mp:latest analysis/split_stps_2020.do
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching]
    outputs:
      highly_sensitive:
        covid_stp5: output/input_covid_matching_2020_stp5.csv
        covid_stp6: output/input_covid_matching_2020_stp6.csv
        covid_stp7: output/input_covid_matching_2020_stp7.csv
        covid_stp8: output/input_covid_matching_2020_stp8.csv
        covid_stp9: output/input_covid_matching_2020_stp9.csv
        covid_stp10: output/input_covid_matching_2020_stp10.csv
        covid_stp12: output/input_covid_matching_2020_stp12.csv
        covid_stp13: output/input_covid_matching_2020_stp13.csv
        covid_stp14: output/input_covid_matching_2020_stp14.csv
        covid_stp15: output/input_covid_matching_2020_stp15.csv
        covid_stp16: output/input_covid_matching_2020_stp16.csv
        covid_stp17: output/input_covid_matching_2020_stp17.csv
        covid_stp20: output/input_covid_matching_2020_stp20.csv
        covid_stp21: output/input_covid_matching_2020_stp21.csv
        covid_stp22: output/input_covid_matching_2020_stp22.csv
        covid_stp23: output/input_covid_matching_2020_stp23.csv
        covid_stp24: output/input_covid_matching_2020_stp24.csv
        covid_stp25: output/input_covid_matching_2020_stp25.csv
        covid_stp26: output/input_covid_matching_2020_stp26.csv
        covid_stp27: output/input_covid_matching_2020_stp27.csv
        covid_stp29: output/input_covid_matching_2020_stp29.csv
        covid_stp33: output/input_covid_matching_2020_stp33.csv
        covid_stp35: output/input_covid_matching_2020_stp35.csv
        covid_stp36: output/input_covid_matching_2020_stp36.csv
        covid_stp37: output/input_covid_matching_2020_stp37.csv
        covid_stp40: output/input_covid_matching_2020_stp40.csv
        covid_stp41: output/input_covid_matching_2020_stp41.csv
        covid_stp42: output/input_covid_matching_2020_stp42.csv
        covid_stp43: output/input_covid_matching_2020_stp43.csv
        covid_stp44: output/input_covid_matching_2020_stp44.csv
        covid_stp49: output/input_covid_matching_2020_stp49.csv
        2020_stp5: output/input_2020_matching_stp5.csv
        2020_stp6: output/input_2020_matching_stp6.csv
        2020_stp7: output/input_2020_matching_stp7.csv
        2020_stp8: output/input_2020_matching_stp8.csv
        2020_stp9: output/input_2020_matching_stp9.csv
        2020_stp10: output/input_2020_matching_stp10.csv
        2020_stp12: output/input_2020_matching_stp12.csv
        2020_stp13: output/input_2020_matching_stp13.csv
        2020_stp14: output/input_2020_matching_stp14.csv
        2020_stp15: output/input_2020_matching_stp15.csv
        2020_stp16: output/input_2020_matching_stp16.csv
        2020_stp17: output/input_2020_matching_stp17.csv
        2020_stp20: output/input_2020_matching_stp20.csv
        2020_stp21: output/input_2020_matching_stp21.csv
        2020_stp22: output/input_2020_matching_stp22.csv
        2020_stp23: output/input_2020_matching_stp23.csv
        2020_stp24: output/input_2020_matching_stp24.csv
        2020_stp25: output/input_2020_matching_stp25.csv
        2020_stp26: output/input_2020_matching_stp26.csv
        2020_stp27: output/input_2020_matching_stp27.csv
        2020_stp29: output/input_2020_matching_stp29.csv
        2020_stp33: output/input_2020_matching_stp33.csv
        2020_stp35: output/input_2020_matching_stp35.csv
        2020_stp36: output/input_2020_matching_stp36.csv
        2020_stp37: output/input_2020_matching_stp37.csv
        2020_stp40: output/input_2020_matching_stp40.csv
        2020_stp41: output/input_2020_matching_stp41.csv
        2020_stp42: output/input_2020_matching_stp42.csv
        2020_stp43: output/input_2020_matching_stp43.csv
        2020_stp44: output/input_2020_matching_stp44.csv
        2020_stp49: output/input_2020_matching_stp49.csv
      moderately_sensitive:
        log: logs/split_stps_2020.log

  match_2020_stp5:
    run: python:latest python analysis/match_2020_stp5.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp5: output/matching_report_2020_stp5.txt
      highly_sensitive:
        matched_matches_stp5: output/matched_matches_2020_stp5.csv
        matched_cases_stp5: output/matched_cases_2020_stp5.csv
        matched_all_stp5: output/matched_combined_2020_stp5.csv

  match_2020_stp6:
    run: python:latest python analysis/match_2020_stp6.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp6: output/matching_report_2020_stp6.txt
      highly_sensitive:
        matched_matches_stp6: output/matched_matches_2020_stp6.csv
        matched_cases_stp6: output/matched_cases_2020_stp6.csv
        matched_all_stp6: output/matched_combined_2020_stp6.csv

  match_2020_stp7:
    run: python:latest python analysis/match_2020_stp7.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp7: output/matching_report_2020_stp7.txt
      highly_sensitive:
        matched_matches_stp7: output/matched_matches_2020_stp7.csv
        matched_cases_stp7: output/matched_cases_2020_stp7.csv
        matched_all_stp7: output/matched_combined_2020_stp7.csv

  match_2020_stp8:
    run: python:latest python analysis/match_2020_stp8.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp8: output/matching_report_2020_stp8.txt
      highly_sensitive:
        matched_matches_stp8: output/matched_matches_2020_stp8.csv
        matched_cases_stp8: output/matched_cases_2020_stp8.csv
        matched_all_stp8: output/matched_combined_2020_stp8.csv

  match_2020_stp9:
    run: python:latest python analysis/match_2020_stp9.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp9: output/matching_report_2020_stp9.txt
      highly_sensitive:
        matched_matches_stp9: output/matched_matches_2020_stp9.csv
        matched_cases_stp9: output/matched_cases_2020_stp9.csv
        matched_all_stp9: output/matched_combined_2020_stp9.csv

  match_2020_stp10:
    run: python:latest python analysis/match_2020_stp10.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp10: output/matching_report_2020_stp10.txt
      highly_sensitive:
        matched_matches_stp10: output/matched_matches_2020_stp10.csv
        matched_cases_stp10: output/matched_cases_2020_stp10.csv
        matched_all_stp10: output/matched_combined_2020_stp10.csv

  match_2020_stp12:
    run: python:latest python analysis/match_2020_stp12.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp12: output/matching_report_2020_stp12.txt
      highly_sensitive:
        matched_matches_stp12: output/matched_matches_2020_stp12.csv
        matched_cases_stp12: output/matched_cases_2020_stp12.csv
        matched_all_stp12: output/matched_combined_2020_stp12.csv

  match_2020_stp13:
    run: python:latest python analysis/match_2020_stp13.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp13: output/matching_report_2020_stp13.txt
      highly_sensitive:
        matched_matches_stp13: output/matched_matches_2020_stp13.csv
        matched_cases_stp13: output/matched_cases_2020_stp13.csv
        matched_all_stp13: output/matched_combined_2020_stp13.csv

  match_2020_stp14:
    run: python:latest python analysis/match_2020_stp14.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp14: output/matching_report_2020_stp14.txt
      highly_sensitive:
        matched_matches_stp14: output/matched_matches_2020_stp14.csv
        matched_cases_stp14: output/matched_cases_2020_stp14.csv
        matched_all_stp14: output/matched_combined_2020_stp14.csv

  match_2020_stp15:
    run: python:latest python analysis/match_2020_stp15.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp15: output/matching_report_2020_stp15.txt
      highly_sensitive:
        matched_matches_stp15: output/matched_matches_2020_stp15.csv
        matched_cases_stp15: output/matched_cases_2020_stp15.csv
        matched_all_stp15: output/matched_combined_2020_stp15.csv

  match_2020_stp16:
    run: python:latest python analysis/match_2020_stp16.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp16: output/matching_report_2020_stp16.txt
      highly_sensitive:
        matched_matches_stp16: output/matched_matches_2020_stp16.csv
        matched_cases_stp16: output/matched_cases_2020_stp16.csv
        matched_all_stp16: output/matched_combined_2020_stp16.csv

  match_2020_stp17:
    run: python:latest python analysis/match_2020_stp17.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp17: output/matching_report_2020_stp17.txt
      highly_sensitive:
        matched_matches_stp17: output/matched_matches_2020_stp17.csv
        matched_cases_stp17: output/matched_cases_2020_stp17.csv
        matched_all_stp17: output/matched_combined_2020_stp17.csv

  match_2020_stp20:
    run: python:latest python analysis/match_2020_stp20.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp20: output/matching_report_2020_stp20.txt
      highly_sensitive:
        matched_matches_stp20: output/matched_matches_2020_stp20.csv
        matched_cases_stp20: output/matched_cases_2020_stp20.csv
        matched_all_stp20: output/matched_combined_2020_stp20.csv

  match_2020_stp21:
    run: python:latest python analysis/match_2020_stp21.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp21: output/matching_report_2020_stp21.txt
      highly_sensitive:
        matched_matches_stp21: output/matched_matches_2020_stp21.csv
        matched_cases_stp21: output/matched_cases_2020_stp21.csv
        matched_all_stp21: output/matched_combined_2020_stp21.csv

  match_2020_stp22:
    run: python:latest python analysis/match_2020_stp22.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp22: output/matching_report_2020_stp22.txt
      highly_sensitive:
        matched_matches_stp22: output/matched_matches_2020_stp22.csv
        matched_cases_stp22: output/matched_cases_2020_stp22.csv
        matched_all_stp22: output/matched_combined_2020_stp22.csv

  match_2020_stp23:
    run: python:latest python analysis/match_2020_stp23.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp23: output/matching_report_2020_stp23.txt
      highly_sensitive:
        matched_matches_stp23: output/matched_matches_2020_stp23.csv
        matched_cases_stp23: output/matched_cases_2020_stp23.csv
        matched_all_stp23: output/matched_combined_2020_stp23.csv

  match_2020_stp24:
    run: python:latest python analysis/match_2020_stp24.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp24: output/matching_report_2020_stp24.txt
      highly_sensitive:
        matched_matches_stp24: output/matched_matches_2020_stp24.csv
        matched_cases_stp24: output/matched_cases_2020_stp24.csv
        matched_all_stp24: output/matched_combined_2020_stp24.csv

  match_2020_stp25:
    run: python:latest python analysis/match_2020_stp25.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp25: output/matching_report_2020_stp25.txt
      highly_sensitive:
        matched_matches_stp25: output/matched_matches_2020_stp25.csv
        matched_cases_stp25: output/matched_cases_2020_stp25.csv
        matched_all_stp25: output/matched_combined_2020_stp25.csv

  match_2020_stp26:
    run: python:latest python analysis/match_2020_stp26.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp26: output/matching_report_2020_stp26.txt
      highly_sensitive:
        matched_matches_stp26: output/matched_matches_2020_stp26.csv
        matched_cases_stp26: output/matched_cases_2020_stp26.csv
        matched_all_stp26: output/matched_combined_2020_stp26.csv

  match_2020_stp27:
    run: python:latest python analysis/match_2020_stp27.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp27: output/matching_report_2020_stp27.txt
      highly_sensitive:
        matched_matches_stp27: output/matched_matches_2020_stp27.csv
        matched_cases_stp27: output/matched_cases_2020_stp27.csv
        matched_all_stp27: output/matched_combined_2020_stp27.csv

  match_2020_stp29:
    run: python:latest python analysis/match_2020_stp29.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp29: output/matching_report_2020_stp29.txt
      highly_sensitive:
        matched_matches_stp29: output/matched_matches_2020_stp29.csv
        matched_cases_stp29: output/matched_cases_2020_stp29.csv
        matched_all_stp29: output/matched_combined_2020_stp29.csv

  match_2020_stp33:
    run: python:latest python analysis/match_2020_stp33.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp33: output/matching_report_2020_stp33.txt
      highly_sensitive:
        matched_matches_stp33: output/matched_matches_2020_stp33.csv
        matched_cases_stp33: output/matched_cases_2020_stp33.csv
        matched_all_stp33: output/matched_combined_2020_stp33.csv

  match_2020_stp35:
    run: python:latest python analysis/match_2020_stp35.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp35: output/matching_report_2020_stp35.txt
      highly_sensitive:
        matched_matches_stp35: output/matched_matches_2020_stp35.csv
        matched_cases_stp35: output/matched_cases_2020_stp35.csv
        matched_all_stp35: output/matched_combined_2020_stp35.csv

  match_2020_stp36:
    run: python:latest python analysis/match_2020_stp36.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp36: output/matching_report_2020_stp36.txt
      highly_sensitive:
        matched_matches_stp36: output/matched_matches_2020_stp36.csv
        matched_cases_stp36: output/matched_cases_2020_stp36.csv
        matched_all_stp36: output/matched_combined_2020_stp36.csv

  match_2020_stp37:
    run: python:latest python analysis/match_2020_stp37.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp37: output/matching_report_2020_stp37.txt
      highly_sensitive:
        matched_matches_stp37: output/matched_matches_2020_stp37.csv
        matched_cases_stp37: output/matched_cases_2020_stp37.csv
        matched_all_stp37: output/matched_combined_2020_stp37.csv

  match_2020_stp40:
    run: python:latest python analysis/match_2020_stp40.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp40: output/matching_report_2020_stp40.txt
      highly_sensitive:
        matched_matches_stp40: output/matched_matches_2020_stp40.csv
        matched_cases_stp40: output/matched_cases_2020_stp40.csv
        matched_all_stp40: output/matched_combined_2020_stp40.csv

  match_2020_stp41:
    run: python:latest python analysis/match_2020_stp41.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp41: output/matching_report_2020_stp41.txt
      highly_sensitive:
        matched_matches_stp41: output/matched_matches_2020_stp41.csv
        matched_cases_stp41: output/matched_cases_2020_stp41.csv
        matched_all_stp41: output/matched_combined_2020_stp41.csv

  match_2020_stp42:
    run: python:latest python analysis/match_2020_stp42.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp42: output/matching_report_2020_stp42.txt
      highly_sensitive:
        matched_matches_stp42: output/matched_matches_2020_stp42.csv
        matched_cases_stp42: output/matched_cases_2020_stp42.csv
        matched_all_stp42: output/matched_combined_2020_stp42.csv

  match_2020_stp43:
    run: python:latest python analysis/match_2020_stp43.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp43: output/matching_report_2020_stp43.txt
      highly_sensitive:
        matched_matches_stp43: output/matched_matches_2020_stp43.csv
        matched_cases_stp43: output/matched_cases_2020_stp43.csv
        matched_all_stp43: output/matched_combined_2020_stp43.csv

  match_2020_stp44:
    run: python:latest python analysis/match_2020_stp44.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp44: output/matching_report_2020_stp44.txt
      highly_sensitive:
        matched_matches_stp44: output/matched_matches_2020_stp44.csv
        matched_cases_stp44: output/matched_cases_2020_stp44.csv
        matched_all_stp44: output/matched_combined_2020_stp44.csv

  match_2020_stp49:
    run: python:latest python analysis/match_2020_stp49.py
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp49: output/matching_report_2020_stp49.txt
      highly_sensitive:
        matched_matches_stp49: output/matched_matches_2020_stp49.csv
        matched_cases_stp49: output/matched_cases_2020_stp49.csv
        matched_all_stp49: output/matched_combined_2020_stp49.csv

  combine_stps_covid_2020:
    run: stata-mp:latest analysis/combine_stps_covid_2020.do
    needs: [match_2020_stp5, match_2020_stp6, match_2020_stp7, match_2020_stp8, match_2020_stp9,
    match_2020_stp10, match_2020_stp12, match_2020_stp13, match_2020_stp14, match_2020_stp15,
    match_2020_stp16, match_2020_stp17, match_2020_stp20, match_2020_stp21, match_2020_stp22,
    match_2020_stp23, match_2020_stp24, match_2020_stp25, match_2020_stp26, match_2020_stp27,
    match_2020_stp29, match_2020_stp33, match_2020_stp35, match_2020_stp36, match_2020_stp37, 
    match_2020_stp40, match_2020_stp41, match_2020_stp42, match_2020_stp43, match_2020_stp44, 
    match_2020_stp49]
    outputs:
      highly_sensitive:
        matched_cases_combined: output/input_combined_stps_covid_2020.csv
      moderately_sensitive:
        log: logs/combine_stps_covid_2020.log

  combine_stps_matches_2020:
    run: stata-mp:latest analysis/combine_stps_matches_2020.do
    needs: [match_2020_stp5, match_2020_stp6, match_2020_stp7, match_2020_stp8, match_2020_stp9,
    match_2020_stp10, match_2020_stp12, match_2020_stp13, match_2020_stp14, match_2020_stp15,
    match_2020_stp16, match_2020_stp17, match_2020_stp20, match_2020_stp21, match_2020_stp22,
    match_2020_stp23, match_2020_stp24, match_2020_stp25, match_2020_stp26, match_2020_stp27,
    match_2020_stp29, match_2020_stp33, match_2020_stp35, match_2020_stp36, match_2020_stp37, 
    match_2020_stp40, match_2020_stp41, match_2020_stp42, match_2020_stp43, match_2020_stp44, 
    match_2020_stp49]
    outputs:
      highly_sensitive:
        matched_matches_combined: output/input_combined_stps_matches_2020.csv
      moderately_sensitive:
        log: logs/combine_stps_matches_2020.log

  extract_covid_2020_additional:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_covid_2020_additional 
    needs: [combine_stps_covid_2020]
    outputs:
      highly_sensitive:
        cohort: output/input_covid_2020_additional.csv

  extract_2020_additional:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_2020_additional 
    needs: [combine_stps_matches_2020]
    outputs:
      highly_sensitive:
        cohort: output/input_2020_additional.csv

  analysis_2020:
    run: stata-mp:latest analysis/analysis_2020.do
    needs: [extract_covid_matching, clean_covid_matching_2020, extract_2020_matching, clean_2020_matching, split_stps_2020, match_2020_stp5, match_2020_stp6, match_2020_stp7, match_2020_stp8, match_2020_stp9, match_2020_stp10, match_2020_stp12, match_2020_stp13, match_2020_stp14, match_2020_stp15, match_2020_stp16, match_2020_stp17, match_2020_stp20, match_2020_stp21, match_2020_stp22, match_2020_stp23, match_2020_stp24, match_2020_stp25, match_2020_stp26, match_2020_stp27, match_2020_stp29, match_2020_stp33, match_2020_stp35, match_2020_stp36, match_2020_stp37, match_2020_stp40, match_2020_stp41, match_2020_stp42, match_2020_stp43, match_2020_stp44, match_2020_stp49, combine_stps_covid_2020, combine_stps_matches_2020, extract_covid_2020_additional, extract_2020_additional]
    outputs:
      highly_sensitive:
        analysis: output/analysis_2020.dta
      moderately_sensitive:
        log: logs/analysis_2020.log

  events_crude_2017_esrd:
    run: stata-mp:latest analysis/events_crude_2017_esrd.do
    needs: [analysis_2017]
    outputs:
      moderately_sensitive:
        log: logs/events_crude_2017_esrd.log
        output: output/events_crude_2017_esrd.csv

  events_crude_2017_egfr_half:
    run: stata-mp:latest analysis/events_crude_2017_egfr_half.do
    needs: [analysis_2017]
    outputs:
      moderately_sensitive:
        log: logs/events_crude_2017_egfr_half.log
        output: output/events_crude_2017_egfr_half.csv

  events_crude_2017_aki:
    run: stata-mp:latest analysis/events_crude_2017_aki.do
    needs: [analysis_2017]
    outputs:
      moderately_sensitive:
        log: logs/events_crude_2017_aki.log
        output: output/events_crude_2017_aki.csv

  events_crude_2017_death:
    run: stata-mp:latest analysis/events_crude_2017_death.do
    needs: [analysis_2017]
    outputs:
      moderately_sensitive:
        log: logs/events_crude_2017_death.log
        output: output/events_crude_2017_death.csv

  events_crude_2020_esrd:
    run: stata-mp:latest analysis/events_crude_2020_esrd.do
    needs: [analysis_2020]
    outputs:
      moderately_sensitive:
        log: logs/events_crude_2020_esrd.log
        output: output/events_crude_2020_esrd.csv

  events_crude_2020_egfr_half:
    run: stata-mp:latest analysis/events_crude_2020_egfr_half.do
    needs: [analysis_2020]
    outputs:
      moderately_sensitive:
        log: logs/events_crude_2020_egfr_half.log
        output: output/events_crude_2020_egfr_half.csv

  events_crude_2020_aki:
    run: stata-mp:latest analysis/events_crude_2020_aki.do
    needs: [analysis_2020]
    outputs:
      moderately_sensitive:
        log: logs/events_crude_2020_aki.log
        output: output/events_crude_2020_aki.csv

  events_crude_2020_death:
    run: stata-mp:latest analysis/events_crude_2020_death.do
    needs: [analysis_2020]
    outputs:
      moderately_sensitive:
        log: logs/events_crude_2020_death.log
        output: output/events_crude_2020_death.csv

  analysis_complete:
    run: stata-mp:latest analysis/analysis_complete.do
    needs: [analysis_2017, analysis_2020]
    outputs:
      highly_sensitive:
        analysis_2017: output/analysis_complete_2017.dta
        analysis_2020: output/analysis_complete_2020.dta
      moderately_sensitive:
        log: logs/analysis_complete.log

  analysis_complete_hospitalised:
    run: stata-mp:latest analysis/analysis_complete_hospitalised.do
    needs: [analysis_hospitalised]
    outputs:
      highly_sensitive:
        dataset: output/analysis_complete_hospitalised.dta
      moderately_sensitive:
        log: logs/analysis_complete_hospitalised.log

  events_cca_hospitalised_esrd:
    run: stata-mp:latest analysis/events_cca_hospitalised_esrd.do
    needs: [analysis_complete_hospitalised]
    outputs:
      moderately_sensitive:
        log: logs/events_cca_hospitalised_esrd.log
        output: output/events_cca_hospitalised_esrd.csv

  events_cca_hospitalised_egfr_half:
    run: stata-mp:latest analysis/events_cca_hospitalised_egfr_half.do
    needs: [analysis_complete_hospitalised]
    outputs:
      moderately_sensitive:
        log: logs/events_cca_hospitalised_egfr_half.log
        output: output/events_cca_hospitalised_egfr_half.csv

  events_cca_hospitalised_aki:
    run: stata-mp:latest analysis/events_cca_hospitalised_aki.do
    needs: [analysis_complete_hospitalised]
    outputs:
      moderately_sensitive:
        log: logs/events_cca_hospitalised_aki.log
        output: output/events_cca_hospitalised_aki.csv

  events_cca_hospitalised_death:
    run: stata-mp:latest analysis/events_cca_hospitalised_death.do
    needs: [analysis_complete_hospitalised]
    outputs:
      moderately_sensitive:
        log: logs/events_cca_hospitalised_death.log
        output: output/events_cca_hospitalised_death.csv

  events_crude_hospitalised_esrd:
    run: stata-mp:latest analysis/events_crude_hospitalised_esrd.do
    needs: [analysis_hospitalised]
    outputs:
      moderately_sensitive:
        log: logs/events_crude_hospitalised_esrd.log
        output: output/events_crude_hospitalised_esrd.csv

  events_crude_hospitalised_egfr_half:
    run: stata-mp:latest analysis/events_crude_hospitalised_egfr_half.do
    needs: [analysis_hospitalised]
    outputs:
      moderately_sensitive:
        log: logs/events_crude_hospitalised_egfr_half.log
        output: output/events_crude_hospitalised_egfr_half.csv

  events_crude_hospitalised_aki:
    run: stata-mp:latest analysis/events_crude_hospitalised_aki.do
    needs: [analysis_hospitalised]
    outputs:
      moderately_sensitive:
        log: logs/events_crude_hospitalised_aki.log
        output: output/events_crude_hospitalised_aki.csv

  events_crude_hospitalised_death:
    run: stata-mp:latest analysis/events_crude_hospitalised_death.do
    needs: [analysis_hospitalised]
    outputs:
      moderately_sensitive:
        log: logs/events_crude_hospitalised_death.log
        output: output/events_crude_hospitalised_death.csv

  crude_events_esrd:
    run: stata-mp:latest analysis/crude_events_esrd.do
    needs: [analysis_2017, analysis_2020, analysis_hospitalised]
    outputs:
      moderately_sensitive:
        log: logs/crude_events_esrd.log
        output: output/crude_events_esrd.csv

  crude_events_egfr_half:
    run: stata-mp:latest analysis/crude_events_egfr_half.do
    needs: [analysis_2017, analysis_2020, analysis_hospitalised]
    outputs:
      moderately_sensitive:
        log: logs/crude_events_egfr_half.log
        output: output/crude_events_egfr_half.csv

  crude_events_aki:
    run: stata-mp:latest analysis/crude_events_aki.do
    needs: [analysis_2017, analysis_2020, analysis_hospitalised]
    outputs:
      moderately_sensitive:
        log: logs/crude_events_aki.log
        output: output/crude_events_aki.csv

  crude_events_death:
    run: stata-mp:latest analysis/crude_events_death.do
    needs: [analysis_2017, analysis_2020, analysis_hospitalised]
    outputs:
      moderately_sensitive:
        log: logs/crude_events_death.log
        output: output/crude_events_death.csv

  cca_events_esrd:
    run: stata-mp:latest analysis/cca_events_esrd.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_esrd.log
        output: output/cca_events_esrd.csv

  cca_events_egfr_half:
    run: stata-mp:latest analysis/cca_events_egfr_half.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_egfr_half.log
        output: output/cca_events_egfr_half.csv

  cca_events_aki:
    run: stata-mp:latest analysis/cca_events_aki.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_aki.log
        output: output/cca_events_aki.csv

  cca_events_death:
    run: stata-mp:latest analysis/cca_events_death.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_death.log
        output: output/cca_events_death.csv

  cca_events_egfr_half_2020:
    run: stata-mp:latest analysis/cca_events_egfr_half_2020.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_egfr_half_2020.log
        output: output/cca_events_egfr_half_2020.csv

  cca_events_death_2020:
    run: stata-mp:latest analysis/cca_events_death_2020.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_death_2020.log
        output: output/cca_events_death_2020.csv

  crude_events_covid_severity_esrd:
    run: stata-mp:latest analysis/crude_events_covid_severity_esrd.do
    needs: [analysis_2017, analysis_2020]
    outputs:
      moderately_sensitive:
        log: logs/crude_events_covid_severity_esrd.log
        output: output/crude_events_covid_severity_esrd.csv

  cca_events_covid_aki_esrd:
    run: stata-mp:latest analysis/cca_events_covid_aki_esrd.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_covid_aki_esrd.log
        output: output/cca_events_covid_aki_esrd.csv

  cca_events_covid_aki_egfr_half:
    run: stata-mp:latest analysis/cca_events_covid_aki_egfr_half.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_covid_aki_egfr_half.log
        output: output/cca_events_covid_aki_egfr_half.csv

  cca_events_covid_aki_aki:
    run: stata-mp:latest analysis/cca_events_covid_aki_aki.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_covid_aki_aki.log
        output: output/cca_events_covid_aki_aki.csv

  cca_events_covid_aki_death:
    run: stata-mp:latest analysis/cca_events_covid_aki_death.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_covid_aki_death.log
        output: output/cca_events_covid_aki_death.csv

  descriptive_2017:
    run: stata-mp:latest analysis/descriptive_2017.do
    needs: [analysis_2017]
    outputs:
      moderately_sensitive:
        log: logs/descriptive_2017.log
        output: output/descriptive_2017.csv

  descriptive_2020:
    run: stata-mp:latest analysis/descriptive_2020.do
    needs: [analysis_2020]
    outputs:
      moderately_sensitive:
        log: logs/descriptive_2020.log
        output: output/descriptive_2020.csv

  crude_rates_esrd_2017:
    run: stata-mp:latest analysis/crude_rates_esrd_2017.do
    needs: [analysis_2017]
    outputs:
      moderately_sensitive:
        log: logs/crude_rates_esrd_2017.log
        output: output/crude_rates_esrd_2017.csv

  crude_rates_egfr_half_2017:
    run: stata-mp:latest analysis/crude_rates_egfr_half_2017.do
    needs: [analysis_2017]
    outputs:
      moderately_sensitive:
        log: logs/crude_rates_egfr_half_2017.log
        output: output/crude_rates_egfr_half_2017.csv

  crude_rates_aki_2017:
    run: stata-mp:latest analysis/crude_rates_aki_2017.do
    needs: [analysis_2017]
    outputs:
      moderately_sensitive:
        log: logs/crude_rates_aki_2017.log
        output: output/crude_rates_aki_2017.csv

  crude_rates_death_2017:
    run: stata-mp:latest analysis/crude_rates_death_2017.do
    needs: [analysis_2017]
    outputs:
      moderately_sensitive:
        log: logs/crude_rates_death_2017.log
        output: output/crude_rates_death_2017.csv

  crude_rates_esrd_2020:
    run: stata-mp:latest analysis/crude_rates_esrd_2020.do
    needs: [analysis_2020]
    outputs:
      moderately_sensitive:
        log: logs/crude_rates_esrd_2020.log
        output: output/crude_rates_esrd_2020.csv

  crude_rates_egfr_half_2020:
    run: stata-mp:latest analysis/crude_rates_egfr_half_2020.do
    needs: [analysis_2020]
    outputs:
      moderately_sensitive:
        log: logs/crude_rates_egfr_half_2020.log
        output: output/crude_rates_egfr_half_2020.csv

  crude_rates_aki_2020:
    run: stata-mp:latest analysis/crude_rates_aki_2020.do
    needs: [analysis_2020]
    outputs:
      moderately_sensitive:
        log: logs/crude_rates_aki_2020.log
        output: output/crude_rates_aki_2020.csv

  crude_rates_death_2020:
    run: stata-mp:latest analysis/crude_rates_death_2020.do
    needs: [analysis_2020]
    outputs:
      moderately_sensitive:
        log: logs/crude_rates_death_2020.log
        output: output/crude_rates_death_2020.csv

  cox_forest_2017:
    run: stata-mp:latest analysis/cox_forest_2017.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2017.log
        output: output/cox_forest_2017.csv

  cox_forest_2020:
    run: stata-mp:latest analysis/cox_forest_2020.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2020.log
        output: output/cox_forest_2020.csv

  cox_forest_2017_chronic:
    run: stata-mp:latest analysis/cox_forest_2017_chronic.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2017_chronic.log
        output: output/cox_forest_2017_chronic.csv

  cox_forest_2020_chronic:
    run: stata-mp:latest analysis/cox_forest_2020_chronic.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2020_chronic.log
        output: output/cox_forest_2020_chronic.csv

  competing_risk_2017:
    run: stata-mp:latest analysis/competing_risk_2017.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: output/competing_risk_2017.log

  competing_risk_2020:
    run: stata-mp:latest analysis/competing_risk_2020.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: output/competing_risk_2020.log

  competing_risk_chronic_2017:
    run: stata-mp:latest analysis/competing_risk_chronic_2017.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: output/competing_risk_chronic_2017.log

  competing_risk_chronic_2020:
    run: stata-mp:latest analysis/competing_risk_chronic_2020.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: output/competing_risk_chronic_2020.log

  descriptive_covid_severity_2017:
    run: stata-mp:latest analysis/descriptive_covid_severity_2017.do
    needs: [analysis_2017]
    outputs:
      moderately_sensitive:
        log: logs/descriptive_covid_severity_2017.log
        output: output/descriptive_covid_severity_2017.csv

  descriptive_cca_2017:
    run: stata-mp:latest analysis/descriptive_cca_2017.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/descriptive_cca_2017.log
        output: output/descriptive_cca_2017.csv

  descriptive_cca_2020:
    run: stata-mp:latest analysis/descriptive_cca_2020.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/descriptive_cca_2020.log
        output: output/descriptive_cca_2020.csv

  descriptive_cca_egfr_2017:
    run: stata-mp:latest analysis/descriptive_cca_egfr_2017.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/descriptive_cca_egfr_2017.log
        output: output/descriptive_cca_egfr_2017.csv

  descriptive_cca_egfr_2020:
    run: stata-mp:latest analysis/descriptive_cca_egfr_2020.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/descriptive_cca_egfr_2020.log
        output: output/descriptive_cca_egfr_2020.csv

  descriptive_covid_severity_2020:
    run: stata-mp:latest analysis/descriptive_covid_severity_2020.do
    needs: [analysis_2020]
    outputs:
      moderately_sensitive:
        log: logs/descriptive_covid_severity_2020.log
        output: output/descriptive_covid_severity_2020.csv

  descriptive_cca_covid_severity_2017:
    run: stata-mp:latest analysis/descriptive_cca_covid_severity_2017.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/descriptive_cca_covid_severity_2017.log
        output: output/descriptive_cca_covid_severity_2017.csv

  descriptive_cca_covid_severity_2020:
    run: stata-mp:latest analysis/descriptive_cca_covid_severity_2020.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/descriptive_cca_covid_severity_2020.log
        output: output/descriptive_cca_covid_severity_2020.csv

  descriptive_hospitalised:
    run: stata-mp:latest analysis/descriptive_hospitalised.do
    needs: [analysis_hospitalised]
    outputs:
      moderately_sensitive:
        log: logs/descriptive_hospitalised.log
        output: output/descriptive_hospitalised.csv

  crude_rates_esrd_hospitalised:
    run: stata-mp:latest analysis/crude_rates_esrd_hospitalised.do
    needs: [analysis_hospitalised]
    outputs:
      moderately_sensitive:
        log: logs/crude_rates_esrd_hospitalised.log
        output: output/crude_rates_esrd_hospitalised.csv

  crude_rates_egfr_half_hospitalised:
    run: stata-mp:latest analysis/crude_rates_egfr_half_hospitalised.do
    needs: [analysis_hospitalised]
    outputs:
      moderately_sensitive:
        log: logs/crude_rates_egfr_half_hospitalised.log
        output: output/crude_rates_egfr_half_hospitalised.csv

  crude_rates_aki_hospitalised:
    run: stata-mp:latest analysis/crude_rates_aki_hospitalised.do
    needs: [analysis_hospitalised]
    outputs:
      moderately_sensitive:
        log: logs/crude_rates_aki_hospitalised.log
        output: output/crude_rates_aki_hospitalised.csv

  crude_rates_death_hospitalised:
    run: stata-mp:latest analysis/crude_rates_death_hospitalised.do
    needs: [analysis_hospitalised]
    outputs:
      moderately_sensitive:
        log: logs/crude_rates_death_hospitalised.log
        output: output/crude_rates_death_hospitalised.csv

  cox_forest_hospitalised:
    run: stata-mp:latest analysis/cox_forest_hospitalised.do
    needs: [analysis_hospitalised]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_hospitalised.log
        output: output/cox_forest_hospitalised.csv

  cox_forest_2017_covid_severity_esrd:
    run: stata-mp:latest analysis/cox_forest_2017_covid_severity_esrd.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2017_covid_severity_esrd.log
        output: output/cox_forest_2017_covid_severity_esrd.csv

  cox_forest_2020_covid_severity_esrd:
    run: stata-mp:latest analysis/cox_forest_2020_covid_severity_esrd.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2020_covid_severity_esrd.log
        output: output/cox_forest_2020_covid_severity_esrd.csv

  cox_forest_2020_covid_severity_egfr_half:
    run: stata-mp:latest analysis/cox_forest_2020_covid_severity_egfr_half.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2020_covid_severity_egfr_half.log
        output: output/cox_forest_2020_covid_severity_egfr_half.csv

  cox_forest_2020_covid_severity_death:
    run: stata-mp:latest analysis/cox_forest_2020_covid_severity_death.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2020_covid_severity_death.log
        output: output/cox_forest_2020_covid_severity_death.csv

  cox_forest_2017_sens:
    run: stata-mp:latest analysis/cox_forest_2017_sens.do
    needs: [analysis_2017, analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2017_sens.log
        output: output/cox_forest_2017_sens.csv

  cox_forest_2020_sens:
    run: stata-mp:latest analysis/cox_forest_2020_sens.do
    needs: [analysis_2020, analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2020_sens.log
        output: output/cox_forest_2020_sens.csv

  cox_forest_2020_sens7:
    run: stata-mp:latest analysis/cox_forest_2020_sens7.do
    needs: [analysis_2020, analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2020_sens7.log
        output: output/cox_forest_2020_sens7.csv

  cca_events_covid_severity_esrd:
    run: stata-mp:latest analysis/cca_events_covid_severity_esrd.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_covid_severity_esrd.log
        output: output/cca_events_covid_severity_esrd.csv

  cca_events_covid_severity_egfr_half_2020:
    run: stata-mp:latest analysis/cca_events_covid_severity_egfr_half_2020.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_covid_severity_egfr_half_2020.log
        output: output/cca_events_covid_severity_egfr_half_2020.csv

  cca_events_covid_severity_death_2020:
    run: stata-mp:latest analysis/cca_events_covid_severity_death_2020.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_covid_severity_death_2020.log
        output: output/cca_events_covid_severity_death_2020.csv

  events_2017_sens:
    run: stata-mp:latest analysis/events_2017_sens.do
    needs: [analysis_2017, analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/events_2017_sens.log
        output: output/events_2017_sens.csv

  events_2020_sens:
    run: stata-mp:latest analysis/events_2020_sens.do
    needs: [analysis_2020, analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/events_2020_sens.log
        output: output/events_2020_sens.csv

  cox_curve_2017:
    run: stata-mp:latest analysis/cox_curve_2017.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_curve_2017.log
        figure1: output/failure_curve_case_esrd_2017.svg  
        figure2: output/failure_curve_case_egfr_half_2017.svg  
        figure3: output/failure_curve_case_aki_2017.svg  
        figure4: output/failure_curve_case_death_2017.svg  
        figure5: output/failure_curve_covid_severity_esrd_2017.svg  
        figure6: output/failure_curve_covid_severity_egfr_half_2017.svg  
        figure7: output/failure_curve_covid_severity_aki_2017.svg  
        figure8: output/failure_curve_covid_severity_death_2017.svg  
        figure9: output/failure_curve_covid_aki_esrd_2017.svg  
        figure10: output/failure_curve_covid_aki_egfr_half_2017.svg  
        figure11: output/failure_curve_covid_aki_aki_2017.svg  
        figure12: output/failure_curve_covid_aki_death_2017.svg  
        figure13: output/failure_curve_covid_vax_esrd_2017.svg  
        figure14: output/failure_curve_covid_vax_egfr_half_2017.svg  
        figure15: output/failure_curve_covid_vax_aki_2017.svg  
        figure16: output/failure_curve_covid_vax_death_2017.svg  
        figure17: output/failure_curve_wave_esrd_2017.svg  
        figure18: output/failure_curve_wave_egfr_half_2017.svg  
        figure19: output/failure_curve_wave_aki_2017.svg  
        figure20: output/failure_curve_wave_death_2017.svg  

  cox_curve_2020:
    run: stata-mp:latest analysis/cox_curve_2020.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_curve_2020.log
        figure1: output/failure_curve_case_esrd_2020.svg  
        figure2: output/failure_curve_case_egfr_half_2020.svg  
        figure3: output/failure_curve_case_aki_2020.svg  
        figure4: output/failure_curve_case_death_2020.svg  
        figure5: output/failure_curve_covid_severity_esrd_2020.svg  
        figure6: output/failure_curve_covid_severity_egfr_half_2020.svg  
        figure7: output/failure_curve_covid_severity_aki_2020.svg  
        figure8: output/failure_curve_covid_severity_death_2020.svg  
        figure9: output/failure_curve_covid_aki_esrd_2020.svg  
        figure10: output/failure_curve_covid_aki_egfr_half_2020.svg  
        figure11: output/failure_curve_covid_aki_aki_2020.svg  
        figure12: output/failure_curve_covid_aki_death_2020.svg  

  cox_curve_hosp:
    run: stata-mp:latest analysis/cox_curve_hosp.do
    needs: [analysis_complete_hospitalised]
    outputs:
      moderately_sensitive:
        log: logs/cox_curve_hosp.log
        figure1: output/failure_curve_case_esrd_hosp.svg  
        figure2: output/failure_curve_case_egfr_half_hosp.svg  
        figure3: output/failure_curve_case_aki_hosp.svg  
        figure4: output/failure_curve_case_death_hosp.svg  
        figure5: output/failure_curve_covid_vax_esrd_hosp.svg  
        figure6: output/failure_curve_covid_vax_egfr_half_hosp.svg  
        figure7: output/failure_curve_covid_vax_aki_hosp.svg  
        figure8: output/failure_curve_covid_vax_death_hosp.svg  
        figure9: output/failure_curve_wave_esrd_hosp.svg  
        figure10: output/failure_curve_wave_egfr_half_hosp.svg  
        figure11: output/failure_curve_wave_aki_hosp.svg  
        figure12: output/failure_curve_wave_death_hosp.svg 

  cox_forest_2017_ethnicity_esrd:
    run: stata-mp:latest analysis/cox_forest_2017_ethnicity_esrd.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2017_ethnicity_esrd.log
        output: output/cox_forest_2017_ethnicity_esrd.csv

  cox_forest_2020_ethnicity_esrd:
    run: stata-mp:latest analysis/cox_forest_2020_ethnicity_esrd.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2020_ethnicity_esrd.log
        output: output/cox_forest_2020_ethnicity_esrd.csv

  cox_forest_2017_ethnicity_esrd_mediators:
    run: stata-mp:latest analysis/cox_forest_2017_ethnicity_esrd_mediators.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2017_ethnicity_esrd_mediators.log
        output: output/cox_forest_2017_ethnicity_esrd_mediators.csv

  cox_forest_2020_ethnicity_esrd_mediators:
    run: stata-mp:latest analysis/cox_forest_2020_ethnicity_esrd_mediators.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2020_ethnicity_esrd_mediators.log
        output: output/cox_forest_2020_ethnicity_esrd_mediators.csv    

  events_cca_2017:
    run: stata-mp:latest analysis/events_cca_2017.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/events_cca_2017.log
        output: output/events_cca_2017.csv

  events_cca_2020:
    run: stata-mp:latest analysis/events_cca_2020.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/events_cca_2020.log
        output: output/events_cca_2020.csv

  events_cca_chronic_2017:
    run: stata-mp:latest analysis/events_cca_chronic_2017.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/events_cca_chronic_2017.log
        output: output/events_cca_chronic_2017.csv

  events_cca_chronic_2020:
    run: stata-mp:latest analysis/events_cca_chronic_2020.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/events_cca_chronic_2020.log
        output: output/events_cca_chronic_2020.csv

  events_cca_egfr_half_2020:
    run: stata-mp:latest analysis/events_cca_egfr_half_2020.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/events_cca_egfr_half_2020.log
        output: output/events_cca_egfr_half_2020.csv

  events_cca_hospitalised:
    run: stata-mp:latest analysis/events_cca_hospitalised.do
    needs: [analysis_hospitalised]
    outputs:
      moderately_sensitive:
        log: logs/events_cca_hospitalised.log
        output: output/events_cca_hospitalised.csv

  cox_forest_2017_exposures_esrd:
    run: stata-mp:latest analysis/cox_forest_2017_exposures_esrd.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2017_exposures_esrd.log
        output: output/cox_forest_2017_exposures_esrd.csv

  cox_forest_2020_exposures_esrd:
    run: stata-mp:latest analysis/cox_forest_2020_exposures_esrd.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2020_exposures_esrd.log
        output: output/cox_forest_2020_exposures_esrd.csv

  cox_forest_hospitalised_exposures_esrd:
    run: stata-mp:latest analysis/cox_forest_hospitalised_exposures_esrd.do
    needs: [analysis_hospitalised]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_hospitalised_exposures_esrd.log
        output: output/cox_forest_hospitalised_exposures_esrd.csv

  events_cca_2017_exposures_esrd:
    run: stata-mp:latest analysis/events_cca_2017_exposures_esrd.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/events_cca_2017_exposures_esrd.log
        output: output/events_cca_2017_exposures_esrd.csv

  events_cca_2020_exposures_esrd:
    run: stata-mp:latest analysis/events_cca_2020_exposures_esrd.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/events_cca_2020_exposures_esrd.log
        output: output/events_cca_2020_exposures_esrd.csv

  events_cca_hospitalised_exposures_esrd:
    run: stata-mp:latest analysis/events_cca_hospitalised_exposures_esrd.do
    needs: [analysis_hospitalised]
    outputs:
      moderately_sensitive:
        log: logs/events_cca_hospitalised_exposures_esrd.log
        output: output/events_cca_hospitalised_exposures_esrd.csv

  cox_forest_2017_case_esrd:
    run: stata-mp:latest analysis/cox_forest_2017_case_esrd.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2017_case_esrd.log
        output: output/cox_forest_2017_case_esrd.csv

  cox_forest_2020_case_esrd:
    run: stata-mp:latest analysis/cox_forest_2020_case_esrd.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2020_case_esrd.log
        output: output/cox_forest_2020_case_esrd.csv

  cox_forest_2020_case_egfr_half:
    run: stata-mp:latest analysis/cox_forest_2020_case_egfr_half.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2020_case_egfr_half.log
        output: output/cox_forest_2020_case_egfr_half.csv

  cox_forest_2020_case_death:
    run: stata-mp:latest analysis/cox_forest_2020_case_death.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2020_case_death.log
        output: output/cox_forest_2020_case_death.csv

  events_split_2020:
    run: stata-mp:latest analysis/events_split_2020.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/events_split_2020.log
        output: output/events_split_2020.csv

  selection_2017:
    run: stata-mp:latest analysis/selection_2017.do
    needs: [extract_covid_matching, clean_covid_matching_2017, extract_2017_matching, clean_2017_matching, split_stps_2017, match_2017_stp5, match_2017_stp6, match_2017_stp7, match_2017_stp8, match_2017_stp9, match_2017_stp10, match_2017_stp12, match_2017_stp13, match_2017_stp14, match_2017_stp15, match_2017_stp16, match_2017_stp17, match_2017_stp20, match_2017_stp21, match_2017_stp22, match_2017_stp23, match_2017_stp24, match_2017_stp25, match_2017_stp26, match_2017_stp27, match_2017_stp29, match_2017_stp33, match_2017_stp35, match_2017_stp36, match_2017_stp37, match_2017_stp40, match_2017_stp41, match_2017_stp42, match_2017_stp43, match_2017_stp44, match_2017_stp49, combine_stps_covid_2017, combine_stps_matches_2017, extract_covid_2017_additional, extract_2017_additional, analysis_2017]
    outputs:
      moderately_sensitive:
        log: logs/selection_2017.log
        output: output/selection_2017.csv

  selection_2020:
    run: stata-mp:latest analysis/selection_2020.do
    needs: [extract_covid_matching, clean_covid_matching_2020, extract_2020_matching, clean_2020_matching, split_stps_2020, match_2020_stp5, match_2020_stp6, match_2020_stp7, match_2020_stp8, match_2020_stp9, match_2020_stp10, match_2020_stp12, match_2020_stp13, match_2020_stp14, match_2020_stp15, match_2020_stp16, match_2020_stp17, match_2020_stp20, match_2020_stp21, match_2020_stp22, match_2020_stp23, match_2020_stp24, match_2020_stp25, match_2020_stp26, match_2020_stp27, match_2020_stp29, match_2020_stp33, match_2020_stp35, match_2020_stp36, match_2020_stp37, match_2020_stp40, match_2020_stp41, match_2020_stp42, match_2020_stp43, match_2020_stp44, match_2020_stp49, combine_stps_covid_2020, combine_stps_matches_2020, extract_covid_2020_additional, extract_2020_additional, analysis_2020]
    outputs:
      moderately_sensitive:
        log: logs/selection_2020.log
        output: output/selection_2020.csv

  selection_hospitalised:
    run: stata-mp:latest analysis/selection_hospitalised.do
    needs: [extract_covid_hospitalised, extract_pneumonia_hospitalised, analysis_hospitalised]
    outputs:
      moderately_sensitive:
        log: logs/selection_hospitalised.log
        output: output/selection_hospitalised.csv

  cox_forest_2017_ethnicity:
    run: stata-mp:latest analysis/cox_forest_2017_ethnicity.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2017_ethnicity.log
        output: output/cox_forest_2017_ethnicity.csv

  cox_forest_2020_ethnicity:
    run: stata-mp:latest analysis/cox_forest_2020_ethnicity.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2020_ethnicity.log
        output: output/cox_forest_2020_ethnicity.csv

  cox_forest_2017_ethnicity_severity:
    run: stata-mp:latest analysis/cox_forest_2017_ethnicity_severity.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2017_ethnicity_severity.log
        output: output/cox_forest_2017_ethnicity_severity.csv

  cox_forest_2020_ethnicity_severity:
    run: stata-mp:latest analysis/cox_forest_2020_ethnicity_severity.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2020_ethnicity_severity.log
        output: output/cox_forest_2020_ethnicity_severity.csv

  cox_forest_2020_ethnicity_severity_wave:
    run: stata-mp:latest analysis/cox_forest_2020_ethnicity_severity_wave.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2020_ethnicity_severity_wave.log
        output: output/cox_forest_2020_ethnicity_severity_wave.csv

  cox_forest_2020_ethnicity_wave:
    run: stata-mp:latest analysis/cox_forest_2020_ethnicity_wave.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2020_ethnicity_wave.log
        output: output/cox_forest_2020_ethnicity_wave.csv

  cox_forest_2017_ethnicity_esrd_wave:
    run: stata-mp:latest analysis/cox_forest_2017_ethnicity_esrd_wave.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2017_ethnicity_esrd_wave.log
        output: output/cox_forest_2017_ethnicity_esrd_wave.csv

  cox_forest_2020_ethnicity_esrd_wave:
    run: stata-mp:latest analysis/cox_forest_2020_ethnicity_esrd_wave.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2020_ethnicity_esrd_wave.log
        output: output/cox_forest_2020_ethnicity_esrd_wave.csv

  extract_stroke:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_stroke
    outputs:
      highly_sensitive:
        cohort: output/input_stroke.csv

  cox_forest_2017_ethnicity_stroke:
    run: stata-mp:latest analysis/cox_forest_2017_ethnicity_stroke.do
    needs: [extract_stroke, analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2017_ethnicity_stroke.log
        output: output/cox_forest_2017_ethnicity_stroke.csv

  cox_forest_2020_ethnicity_stroke:
    run: stata-mp:latest analysis/cox_forest_2020_ethnicity_stroke.do
    needs: [extract_stroke, analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_2020_ethnicity_stroke.log
        output: output/cox_forest_2020_ethnicity_stroke.csv

  cca_events_esrd_ethnicity_wave_2017:
    run: stata-mp:latest analysis/cca_events_esrd_ethnicity_wave_2017.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_esrd_ethnicity_wave_2017.log
        output: output/cca_events_esrd_ethnicity_wave_2017.csv

  cca_events_esrd_ethnicity_wave_2020:
    run: stata-mp:latest analysis/cca_events_esrd_ethnicity_wave_2020.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_esrd_ethnicity_wave_2020.log
        output: output/cca_events_esrd_ethnicity_wave_2020.csv

  cca_events_stroke_2017:
    run: stata-mp:latest analysis/cca_events_stroke_2017.do
    needs: [extract_stroke, analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_stroke_2017.log
        output: output/cca_events_stroke_2017.csv

  cca_events_stroke_2020:
    run: stata-mp:latest analysis/cca_events_stroke_2020.do
    needs: [extract_stroke, analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_stroke_2020.log
        output: output/cca_events_stroke_2020.csv

  cca_events_krt:
    run: stata-mp:latest analysis/cca_events_krt.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_krt.log
        output: output/cca_events_krt.csv

# Extract data required for matching for asthma (negative control) (all STPs)
  extract_asthma_matching_2020:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_asthma_matching_2020
    outputs:
      highly_sensitive:
        cohort: output/input_asthma_matching_2020.csv

#Extract data required for matching for 2017 (all STPs)
  extract_2020_matching_asthma:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_2020_matching_asthma
    outputs:
      highly_sensitive:
        cohort: output/input_2020_matching_asthma.csv

  analysis_asthma_2020:
    run: stata-mp:latest analysis/analysis_asthma_2020.do
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020, match_2020_stp5, match_2020_stp6, match_2020_stp7, match_2020_stp8, match_2020_stp9, match_2020_stp10, match_2020_stp12, match_2020_stp13, match_2020_stp14, match_2020_stp15, match_2020_stp16, match_2020_stp17, match_2020_stp20, match_2020_stp21, match_2020_stp22, match_2020_stp23, match_2020_stp24, match_2020_stp25, match_2020_stp26, match_2020_stp27, match_2020_stp29, match_2020_stp33, match_2020_stp35, match_2020_stp36, match_2020_stp37, match_2020_stp40, match_2020_stp41, match_2020_stp42, match_2020_stp43, match_2020_stp44, match_2020_stp49, combine_stps_covid_2020, combine_stps_matches_2020, extract_covid_2020_additional, extract_2020_additional]
    outputs:
      highly_sensitive:
        analysis: output/analysis_asthma_2020.dta
      moderately_sensitive:
        log: logs/analysis_asthma_2020.log

  analysis_asthma_2020_complete:
    run: stata-mp:latest analysis/analysis_asthma_2020_complete.do
    needs: [analysis_asthma_2020]
    outputs:
      highly_sensitive:
        analysis_2020: output/analysis_asthma_2020_complete.dta
      moderately_sensitive:
        log: logs/analysis_asthma_2020_complete.log

  descriptive_asthma_2020:
    run: stata-mp:latest analysis/descriptive_asthma_2020.do
    needs: [analysis_asthma_2020]
    outputs:
      moderately_sensitive:
        log: logs/descriptive_asthma_2020.log
        output: output/descriptive_asthma_2020.csv

  descriptive_cca_asthma_2020:
    run: stata-mp:latest analysis/descriptive_cca_asthma_2020.do
    needs: [analysis_asthma_2020_complete]
    outputs:
      moderately_sensitive:
        log: logs/descriptive_cca_asthma_2020.log
        output: output/descriptive_cca_asthma_2020.csv

  cox_forest_asthma_2020_ethnicity:
    run: stata-mp:latest analysis/cox_forest_asthma_2020_ethnicity.do
    needs: [analysis_asthma_2020_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_asthma_2020_ethnicity.log
        output: output/cox_forest_asthma_2020_ethnicity.csv

  cox_forest_asthma_2020_ethnicity_covid_censored:
    run: stata-mp:latest analysis/cox_forest_asthma_2020_ethnicity_covid_censored.do
    needs: [analysis_asthma_2020_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_asthma_2020_ethnicity_covid_censored.log
        output: output/cox_forest_asthma_2020_ethnicity_covid_censored.csv

  cca_events_asthma_2020:
    run: stata-mp:latest analysis/cca_events_asthma_2020.do
    needs: [analysis_asthma_2020_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_asthma_2020.log
        output: output/cca_events_asthma_2020.csv

  cca_events_asthma_2020_covid_censored:
    run: stata-mp:latest analysis/cca_events_asthma_2020_covid_censored.do
    needs: [analysis_asthma_2020_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_asthma_2020_covid_censored.log
        output: output/cca_events_asthma_2020_covid_censored.csv

  cox_forest_asthma_2020:
    run: stata-mp:latest analysis/cox_forest_asthma_2020.do
    needs: [analysis_asthma_2020_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_asthma_2020.log
        output: output/cox_forest_asthma_2020.csv

  cox_forest_asthma_2020_covid_censored:
    run: stata-mp:latest analysis/cox_forest_asthma_2020_covid_censored.do
    needs: [analysis_asthma_2020_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_asthma_2020_covid_censored.log
        output: output/cox_forest_asthma_2020_covid_censored.csv

  analysis_asthma_2017:
    run: stata-mp:latest analysis/analysis_asthma_2017.do
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020, match_2020_stp5, match_2020_stp6, match_2020_stp7, match_2020_stp8, match_2020_stp9, match_2020_stp10, match_2020_stp12, match_2020_stp13, match_2020_stp14, match_2020_stp15, match_2020_stp16, match_2020_stp17, match_2020_stp20, match_2020_stp21, match_2020_stp22, match_2020_stp23, match_2020_stp24, match_2020_stp25, match_2020_stp26, match_2020_stp27, match_2020_stp29, match_2020_stp33, match_2020_stp35, match_2020_stp36, match_2020_stp37, match_2020_stp40, match_2020_stp41, match_2020_stp42, match_2020_stp43, match_2020_stp44, match_2020_stp49, combine_stps_covid_2020, combine_stps_matches_2020, extract_covid_2020_additional, extract_2020_additional]
    outputs:
      highly_sensitive:
        analysis: output/analysis_asthma_2017.dta
      moderately_sensitive:
        log: logs/analysis_asthma_2017.log

  analysis_asthma_2017_complete:
    run: stata-mp:latest analysis/analysis_asthma_2017_complete.do
    needs: [analysis_asthma_2017]
    outputs:
      highly_sensitive:
        analysis_2017: output/analysis_asthma_2017_complete.dta
      moderately_sensitive:
        log: logs/analysis_asthma_2017_complete.log

  descriptive_cca_asthma_2017:
    run: stata-mp:latest analysis/descriptive_cca_asthma_2017.do
    needs: [analysis_asthma_2017_complete]
    outputs:
      moderately_sensitive:
        log: logs/descriptive_cca_asthma_2017.log
        output: output/descriptive_cca_asthma_2017.csv

  descriptive_asthma_2017:
    run: stata-mp:latest analysis/descriptive_asthma_2017.do
    needs: [analysis_asthma_2017]
    outputs:
      moderately_sensitive:
        log: logs/descriptive_asthma_2017.log
        output: output/descriptive_asthma_2017.csv

  cox_forest_asthma_2017_ethnicity:
    run: stata-mp:latest analysis/cox_forest_asthma_2017_ethnicity.do
    needs: [analysis_asthma_2017_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_asthma_2017_ethnicity.log
        output: output/cox_forest_asthma_2017_ethnicity.csv

  cox_forest_asthma_2017:
    run: stata-mp:latest analysis/cox_forest_asthma_2017.do
    needs: [analysis_asthma_2017_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_asthma_2017.log
        output: output/cox_forest_asthma_2017.csv

  cca_events_asthma_2017:
    run: stata-mp:latest analysis/cca_events_asthma_2017.do
    needs: [analysis_asthma_2017_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_asthma_2017.log
        output: output/cca_events_asthma_2017.csv

  analysis_pneumonia_2017:
    run: stata-mp:latest analysis/analysis_pneumonia_2017.do
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020, match_2020_stp5, match_2020_stp6, match_2020_stp7, match_2020_stp8, match_2020_stp9, match_2020_stp10, match_2020_stp12, match_2020_stp13, match_2020_stp14, match_2020_stp15, match_2020_stp16, match_2020_stp17, match_2020_stp20, match_2020_stp21, match_2020_stp22, match_2020_stp23, match_2020_stp24, match_2020_stp25, match_2020_stp26, match_2020_stp27, match_2020_stp29, match_2020_stp33, match_2020_stp35, match_2020_stp36, match_2020_stp37, match_2020_stp40, match_2020_stp41, match_2020_stp42, match_2020_stp43, match_2020_stp44, match_2020_stp49, combine_stps_covid_2020, combine_stps_matches_2020, extract_covid_2020_additional, extract_2020_additional]
    outputs:
      highly_sensitive:
        analysis: output/analysis_pneumonia_2017.dta
      moderately_sensitive:
        log: logs/analysis_pneumonia_2017.log

  analysis_pneumonia_2017_complete:
    run: stata-mp:latest analysis/analysis_pneumonia_2017_complete.do
    needs: [analysis_pneumonia_2017]
    outputs:
      highly_sensitive:
        analysis_2017: output/analysis_pneumonia_2017_complete.dta
      moderately_sensitive:
        log: logs/analysis_pneumonia_2017_complete.log

  descriptive_cca_pneumonia_2017:
    run: stata-mp:latest analysis/descriptive_cca_pneumonia_2017.do
    needs: [analysis_pneumonia_2017_complete]
    outputs:
      moderately_sensitive:
        log: logs/descriptive_cca_pneumonia_2017.log
        output: output/descriptive_cca_pneumonia_2017.csv

  descriptive_pneumonia_2017:
    run: stata-mp:latest analysis/descriptive_pneumonia_2017.do
    needs: [analysis_pneumonia_2017]
    outputs:
      moderately_sensitive:
        log: logs/descriptive_pneumonia_2017.log
        output: output/descriptive_pneumonia_2017.csv

  cox_forest_pneumonia_2017_ethnicity:
    run: stata-mp:latest analysis/cox_forest_pneumonia_2017_ethnicity.do
    needs: [analysis_pneumonia_2017_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_pneumonia_2017_ethnicity.log
        output: output/cox_forest_pneumonia_2017_ethnicity.csv

  cox_forest_pneumonia_2017:
    run: stata-mp:latest analysis/cox_forest_pneumonia_2017.do
    needs: [analysis_pneumonia_2017_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_pneumonia_2017.log
        output: output/cox_forest_pneumonia_2017.csv

  cca_events_pneumonia_2017:
    run: stata-mp:latest analysis/cca_events_pneumonia_2017.do
    needs: [analysis_pneumonia_2017_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_pneumonia_2017.log
        output: output/cca_events_pneumonia_2017.csv

  analysis_cabg_2017:
    run: stata-mp:latest analysis/analysis_cabg_2017.do
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020, match_2020_stp5, match_2020_stp6, match_2020_stp7, match_2020_stp8, match_2020_stp9, match_2020_stp10, match_2020_stp12, match_2020_stp13, match_2020_stp14, match_2020_stp15, match_2020_stp16, match_2020_stp17, match_2020_stp20, match_2020_stp21, match_2020_stp22, match_2020_stp23, match_2020_stp24, match_2020_stp25, match_2020_stp26, match_2020_stp27, match_2020_stp29, match_2020_stp33, match_2020_stp35, match_2020_stp36, match_2020_stp37, match_2020_stp40, match_2020_stp41, match_2020_stp42, match_2020_stp43, match_2020_stp44, match_2020_stp49, combine_stps_covid_2020, combine_stps_matches_2020, extract_covid_2020_additional, extract_2020_additional]
    outputs:
      highly_sensitive:
        analysis: output/analysis_cabg_2017.dta
      moderately_sensitive:
        log: logs/analysis_cabg_2017.log

  analysis_cabg_2017_complete:
    run: stata-mp:latest analysis/analysis_cabg_2017_complete.do
    needs: [analysis_cabg_2017]
    outputs:
      highly_sensitive:
        analysis_2017: output/analysis_cabg_2017_complete.dta
      moderately_sensitive:
        log: logs/analysis_cabg_2017_complete.log

  descriptive_cca_cabg_2017:
    run: stata-mp:latest analysis/descriptive_cca_cabg_2017.do
    needs: [analysis_cabg_2017_complete]
    outputs:
      moderately_sensitive:
        log: logs/descriptive_cca_cabg_2017.log
        output: output/descriptive_cca_cabg_2017.csv

  descriptive_cabg_2017:
    run: stata-mp:latest analysis/descriptive_cabg_2017.do
    needs: [analysis_cabg_2017]
    outputs:
      moderately_sensitive:
        log: logs/descriptive_cabg_2017.log
        output: output/descriptive_cabg_2017.csv

  cox_forest_cabg_2017_ethnicity:
    run: stata-mp:latest analysis/cox_forest_cabg_2017_ethnicity.do
    needs: [analysis_cabg_2017_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_cabg_2017_ethnicity.log
        output: output/cox_forest_cabg_2017_ethnicity.csv

  cox_forest_cabg_2017:
    run: stata-mp:latest analysis/cox_forest_cabg_2017.do
    needs: [analysis_cabg_2017_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_cabg_2017.log
        output: output/cox_forest_cabg_2017.csv

  cca_events_cabg_2017:
    run: stata-mp:latest analysis/cca_events_cabg_2017.do
    needs: [analysis_cabg_2017_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_cabg_2017.log
        output: output/cca_events_cabg_2017.csv

  cca_events_ethnicity_2017:
    run: stata-mp:latest analysis/cca_events_ethnicity_2017.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_ethnicity_2017.log
        output: output/cca_events_ethnicity_2017.csv

  cca_events_ethnicity_2020:
    run: stata-mp:latest analysis/cca_events_ethnicity_2020.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_ethnicity_2020.log
        output: output/cca_events_ethnicity_2020.csv

  cca_events_ethnicity_2020_wave:
    run: stata-mp:latest analysis/cca_events_ethnicity_2020_wave.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_ethnicity_2020_wave.log
        output: output/cca_events_ethnicity_2020_wave.csv

  cca_events_ethnicity_severity_2017:
    run: stata-mp:latest analysis/cca_events_ethnicity_severity_2017.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_ethnicity_severity_2017.log
        output: output/cca_events_ethnicity_severity_2017.csv

  cca_events_ethnicity_severity_2020:
    run: stata-mp:latest analysis/cca_events_ethnicity_severity_2020.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_ethnicity_severity_2020.log
        output: output/cca_events_ethnicity_severity_2020.csv

  cca_events_ethnicity_severity_2020_wave:
    run: stata-mp:latest analysis/cca_events_ethnicity_severity_2020_wave.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_ethnicity_severity_2020_wave.log
        output: output/cca_events_ethnicity_severity_2020_wave.csv

  analysis_cabg_2020:
    run: stata-mp:latest analysis/analysis_cabg_2020.do
    needs: [extract_asthma_matching_2020, clean_covid_matching_2020, extract_2020_matching_asthma, clean_2020_matching, split_stps_2020, match_2020_stp5, match_2020_stp6, match_2020_stp7, match_2020_stp8, match_2020_stp9, match_2020_stp10, match_2020_stp12, match_2020_stp13, match_2020_stp14, match_2020_stp15, match_2020_stp16, match_2020_stp17, match_2020_stp20, match_2020_stp21, match_2020_stp22, match_2020_stp23, match_2020_stp24, match_2020_stp25, match_2020_stp26, match_2020_stp27, match_2020_stp29, match_2020_stp33, match_2020_stp35, match_2020_stp36, match_2020_stp37, match_2020_stp40, match_2020_stp41, match_2020_stp42, match_2020_stp43, match_2020_stp44, match_2020_stp49, combine_stps_covid_2020, combine_stps_matches_2020, extract_covid_2020_additional, extract_2020_additional]
    outputs:
      highly_sensitive:
        analysis: output/analysis_cabg_2020.dta
      moderately_sensitive:
        log: logs/analysis_cabg_2020.log

  analysis_cabg_2020_complete:
    run: stata-mp:latest analysis/analysis_cabg_2020_complete.do
    needs: [analysis_cabg_2020]
    outputs:
      highly_sensitive:
        analysis_2020: output/analysis_cabg_2020_complete.dta
      moderately_sensitive:
        log: logs/analysis_cabg_2020_complete.log

  descriptive_cabg_2020:
    run: stata-mp:latest analysis/descriptive_cabg_2020.do
    needs: [analysis_cabg_2020]
    outputs:
      moderately_sensitive:
        log: logs/descriptive_cabg_2020.log
        output: output/descriptive_cabg_2020.csv

  descriptive_cca_cabg_2020:
    run: stata-mp:latest analysis/descriptive_cca_cabg_2020.do
    needs: [analysis_cabg_2020_complete]
    outputs:
      moderately_sensitive:
        log: logs/descriptive_cca_cabg_2020.log
        output: output/descriptive_cca_cabg_2020.csv

  cox_forest_cabg_2020_ethnicity:
    run: stata-mp:latest analysis/cox_forest_cabg_2020_ethnicity.do
    needs: [analysis_cabg_2020_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_cabg_2020_ethnicity.log
        output: output/cox_forest_cabg_2020_ethnicity.csv

  cox_forest_cabg_2020_ethnicity_covid_censored:
    run: stata-mp:latest analysis/cox_forest_cabg_2020_ethnicity_covid_censored.do
    needs: [analysis_cabg_2020_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_cabg_2020_ethnicity_covid_censored.log
        output: output/cox_forest_cabg_2020_ethnicity_covid_censored.csv

  cca_events_cabg_2020:
    run: stata-mp:latest analysis/cca_events_cabg_2020.do
    needs: [analysis_cabg_2020_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_cabg_2020.log
        output: output/cca_events_cabg_2020.csv

  cca_events_cabg_2020_covid_censored:
    run: stata-mp:latest analysis/cca_events_cabg_2020_covid_censored.do
    needs: [analysis_cabg_2020_complete]
    outputs:
      moderately_sensitive:
        log: logs/cca_events_cabg_2020_covid_censored.log
        output: output/cca_events_cabg_2020_covid_censored.csv

  cox_forest_cabg_2020:
    run: stata-mp:latest analysis/cox_forest_cabg_2020.do
    needs: [analysis_cabg_2020_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_cabg_2020.log
        output: output/cox_forest_cabg_2020.csv

  cox_forest_cabg_2020_covid_censored:
    run: stata-mp:latest analysis/cox_forest_cabg_2020_covid_censored.do
    needs: [analysis_cabg_2020_complete]
    outputs:
      moderately_sensitive:
        log: logs/cox_forest_cabg_2020_covid_censored.log
        output: output/cox_forest_cabg_2020_covid_censored.csv

  ph_2020:
    run: stata-mp:latest analysis/ph_2020.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/ph_2020.log

  ph_2017:
    run: stata-mp:latest analysis/ph_2017.do
    needs: [analysis_complete]
    outputs:
      moderately_sensitive:
        log: logs/ph_2017.log

  ph_hospitalised:
    run: stata-mp:latest analysis/ph_hospitalised.do
    needs: [analysis_hospitalised]
    outputs:
      moderately_sensitive:
        log: logs/ph_hospitalised.log