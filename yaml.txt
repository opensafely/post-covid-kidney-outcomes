# Extract data for potential_historical_general_population
  extract_potential_historical_general_population:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_potential_historical_general_population
    outputs:
      highly_sensitive:
        cohort: output/input_potential_historical_general_population.csv

# Extract date for potential_contemporary_general_population
  extract_potential_contemporary_general_population:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_potential_contemporary_general_population
    outputs:
      highly_sensitive:
        cohort: output/input_potential_contemporary_general_population.csv

# Match covid_all_for_matching to potential_historical_general_population
  matching:
    run: python:latest python analysis/match_historical.py
    needs: [extract_covid_all_for_matching, extract_potential_historical_general_population]
    outputs:
      moderately_sensitive:
        matching_report: output/matching_report_historical.txt
      highly_sensitive:
        matched_matches: output/matched_matches_historical.csv

# Match covid_all_for_matching to potential_contemporary_general_population
  matching:
    run: python:latest python analysis/match_contemporary.py
    needs: [extract_covid_all_for_matching, extract_potential_contemporary_general_population]
    outputs:
      moderately_sensitive:
        matching_report: output/matching_report_contemporary.txt
      highly_sensitive:
        matched_matches: output/matched_matches_contemporary.csv

# Extract data for matched_historical_general_population

  extract_controls:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_matched_historical_general_population
    needs: [matching]
    outputs:
      highly_sensitive:
        cohort: output/input_matched_historical_general_population.csv

# Extract data for matched_contemporary_general_population
  extract_controls:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_matched_contemporary_general_population
    needs: [matching]
    outputs:
      highly_sensitive:
        cohort: output/input_matched_contemporary_general_population.csv

# Extract data for covid_all
  generate_covid_all_cohort:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_covid_all
    outputs:
      highly_sensitive:
        cohort: output/input_covid.csv

# Stata analysis files (currently example code - do files for this project not yet written)
# From https://github.com/opensafely/post-covid-outcomes-research/blob/main/project.yaml
      
  covid_rates_cohort:
    run: stata-mp:latest analysis/000_cr_define_covariates_simple_rates.do "covid"
    needs: [generate_covid_cohort]
    outputs:
      highly_sensitive:
        analysis_dataset: output/cohort_rates_covid.dta

  covid_community_rates_cohort:
    run: stata-mp:latest analysis/000_cr_define_covariates_simple_rates.do "covid_community"
    needs: [generate_covid_community_cohort]
    outputs:
      highly_sensitive:
        analysis_dataset: output/cohort_rates_covid_community.dta

  pneumonia_rates_cohort:
    run: stata-mp:latest analysis/000_cr_define_covariates_simple_rates.do "pneumonia"
    needs: [generate_pneumonia_cohort]
    outputs:
      highly_sensitive:
        analysis_dataset: output/cohort_rates_pneumonia.dta

  gen_pop_rates_cohort:
    run: stata-mp:latest analysis/000_cr_define_covariates_simple_rates.do "matched_combined_general_population"
    needs: [matching]
    outputs:
      highly_sensitive:
        analysis_dataset: output/cohort_rates_gen_population.dta

  covid_rates:
    run: stata-mp:latest analysis/201_cr_simple_rates.do "covid"
    needs: [covid_rates_cohort]
    outputs:
      moderately_sensitive:
        rates: output/tabfig/rates_summary_covid.csv

  covid_comm_rates:
    run: stata-mp:latest analysis/201_cr_simple_rates.do "covid_community"
    needs: [covid_community_rates_cohort]
    outputs:
      moderately_sensitive:
        rates: output/tabfig/rates_summary_covid_community.csv

  pneumonia_rates:
    run: stata-mp:latest analysis/201_cr_simple_rates.do "pneumonia"
    needs: [pneumonia_rates_cohort]
    outputs:
      moderately_sensitive:
        rates: output/tabfig/rates_summary_pneumonia.csv

  gen_pop_rates:
    run: stata-mp:latest analysis/201_cr_simple_rates.do "gen_population"
    needs: [gen_pop_rates_cohort]
    outputs:
      moderately_sensitive:
        rates: output/tabfig/rates_summary_gen_population.csv

  baseline_characteristics:
    run: stata-mp:latest analysis/400_baseline_characteristics.do
    needs: [covid_rates_cohort, covid_community_rates_cohort, pneumonia_rates_cohort, gen_pop_rates_cohort]
    outputs:
      moderately_sensitive:
        tables: output/tabfig/an_descriptiveTable_*.txt

  append_cohorts:
    run: stata-mp:latest analysis/300_cr_data_management_matching.do
    needs: [covid_rates_cohort, pneumonia_rates_cohort, gen_pop_rates_cohort]
    outputs:
      moderately_sensitive:
        log: output/append_cohorts.txt
      highly_sensitive: 
        dataset: output/combined_covid_pneumonia.dta
        dataset2: output/combined_covid_gen_population.dta

  cox_models:
    run: stata-mp:latest analysis/302_cox_models.do
    needs: [append_cohorts]
    outputs:
      moderately_sensitive:
        log: output/cox_models.txt
        dataset: output/tabfig/cox_model_summary.csv

# Match covid_all_for_matching to comparators in potential_historical_general_population and potential_contemporary_general_population
# https://docs.opensafely.org/case-control-studies/

# Extract data for covid_england
  extract_covid_england:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_covid_england
    outputs:
      highly_sensitive:
        cohort: output/input_covid_england.csv

#Data management for covid_england
  covid_england:
    run: stata-mp:latest analysis/covid_england.do
    needs: [extract_covid_england]
    outputs:
      highly_sensitive:
        analysis_dataset: output/covid_england.dta
      moderately_sensitive:
        log: logs/covid_england.log

#Descriptive statitics for covid_england
  covid_descriptive:
    run: stata-mp:latest analysis/covid_descriptive.do
    needs: [covid_england]
    outputs:
      highly_sensitive:
        analysis_dataset: output/covid_descriptive.dta
      moderately_sensitive:
        log: logs/covid_descriptive.log

# Extract data required for matching for covid_stp01
  extract_covid_stp01_matching:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_covid_stp01_matching
    outputs:
      highly_sensitive:
        cohort: output/input_covid_stp01_matching.csv

#Data management for covid_stp01_matching
  clean_covid_stp01_matching:
    run: stata-mp:latest analysis/covid_stp01_matching.do
    needs: [extract_covid_stp01_matching]
    outputs:
      highly_sensitive:
        analysis_dataset: output/covid_stp01_matching.csv
      moderately_sensitive:
        log: logs/covid_stp01_matching.log

# Extract data required for matching for contemporary_stp01
  extract_contemporary_stp01_matching:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_contemporary_stp01_matching
    outputs:
      highly_sensitive:
        cohort: output/input_contemporary_stp01_matching.csv

#Data management for contemporary_stp01_matching
  clean_contemporary_stp01_matching:
    run: stata-mp:latest analysis/contemporary_stp01_matching.do
    needs: [extract_contemporary_stp01_matching]
    outputs:
      highly_sensitive:
        analysis_dataset: output/contemporary_stp01_matching.csv
      moderately_sensitive:
        log: logs/contemporary_stp01_matching.log

# Extract data for covid_critical_care
  extract_covid_critical_care:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_covid_critical_care
    outputs:
      highly_sensitive:
        cohort: output/input_covid_critical_care.csv

  covid_critical_care_count:
    run: stata-mp:latest analysis/covid_critical_care.do
    needs: [extract_covid_critical_care]
    outputs:
      highly_sensitive:
        analysis_dataset: output/covid_critical_care.dta
      moderately_sensitive:
        log: logs/covid_critical_care.log

# Extract data for potential_contemporary_general_population
  extract_potential_contemporary_general_population:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_potential_contemporary_general_population
    outputs:
      highly_sensitive:
        cohort: output/input_potential_contemporary_general_population.csv

# Extract data for potential_contemporary_general_population (North East region)
  extract_potential_contemporary_general_population_northeast:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_potential_contemporary_general_population_northeast
    outputs:
      highly_sensitive:
        cohort: output/input_potential_contemporary_general_population_northeast.csv

# Extract data required for matching for covid_northeast
  extract_covid_northeast_matching:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_covid_northeast_matching
    outputs:
      highly_sensitive:
        cohort: output/input_covid_northeast_matching.csv

#Data management for covid_northeast_matching
  clean_covid_northeast_matching:
    run: stata-mp:latest analysis/covid_northeast_matching.do
    needs: [extract_covid_northeast_matching]
    outputs:
      highly_sensitive:
        analysis_dataset: output/covid_northeast_matching.csv
      moderately_sensitive:
        log: logs/covid_northeast_matching.log

# Extract data required for matching for contemporary_northeast
  extract_contemporary_northeast_matching:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_contemporary_northeast_matching
    outputs:
      highly_sensitive:
        cohort: output/input_contemporary_northeast_matching.csv

#Data management for potential_contemporary_population_northeast
  clean_contemporary_northeast_matching:
    run: stata-mp:latest analysis/contemporary_northeast_matching.do
    needs: [extract_contemporary_northeast_matching]
    outputs:
      highly_sensitive:
        analysis_dataset: output/contemporary_northeast_matching.csv
      moderately_sensitive:
        log: logs/contemporary_northeast_matching.log

# Match covid_northeast to potential_contemporary_population_northeast
  match_contemporary_northeast:
    run: python:latest python analysis/match_contemporary_northeast.py
    needs: [extract_covid_northeast_matching, clean_covid_northeast_matching, extract_contemporary_northeast_matching, clean_contemporary_northeast_matching]
    outputs:
      moderately_sensitive:
        matching_report: output/matching_report_contemporary_northeast.txt
      highly_sensitive:
        matched_matches: output/matched_matches_contemporary_northeast.csv


# Split covid_matching and contemporary_matching by STP
  split_stps:
    run: stata-mp:latest analysis/split_stps.do
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching]
    outputs:
      highly_sensitive:
        covid_stp5: output/input_covid_matching_stp5.csv
        covid_stp6: output/input_covid_matching_stp6.csv
        covid_stp7: output/input_covid_matching_stp7.csv
        covid_stp8: output/input_covid_matching_stp8.csv
        covid_stp9: output/input_covid_matching_stp9.csv
        covid_stp10: output/input_covid_matching_stp10.csv
        covid_stp12: output/input_covid_matching_stp12.csv
        covid_stp13: output/input_covid_matching_stp13.csv
        covid_stp14: output/input_covid_matching_stp14.csv
        covid_stp15: output/input_covid_matching_stp15.csv
        covid_stp16: output/input_covid_matching_stp16.csv
        covid_stp17: output/input_covid_matching_stp17.csv
        covid_stp20: output/input_covid_matching_stp20.csv
        covid_stp21: output/input_covid_matching_stp21.csv
        covid_stp22: output/input_covid_matching_stp22.csv
        covid_stp23: output/input_covid_matching_stp23.csv
        covid_stp24: output/input_covid_matching_stp24.csv
        covid_stp25: output/input_covid_matching_stp25.csv
        covid_stp26: output/input_covid_matching_stp26.csv
        covid_stp27: output/input_covid_matching_stp27.csv
        covid_stp29: output/input_covid_matching_stp29.csv
        covid_stp33: output/input_covid_matching_stp33.csv
        covid_stp35: output/input_covid_matching_stp35.csv
        covid_stp36: output/input_covid_matching_stp36.csv
        covid_stp37: output/input_covid_matching_stp37.csv
        covid_stp40: output/input_covid_matching_stp40.csv
        covid_stp41: output/input_covid_matching_stp41.csv
        covid_stp42: output/input_covid_matching_stp42.csv
        covid_stp43: output/input_covid_matching_stp43.csv
        covid_stp44: output/input_covid_matching_stp44.csv
        covid_stp49: output/input_covid_matching_stp49.csv
        contemporary_stp5: output/input_contemporary_matching_stp5.csv
        contemporary_stp6: output/input_contemporary_matching_stp6.csv
        contemporary_stp7: output/input_contemporary_matching_stp7.csv
        contemporary_stp8: output/input_contemporary_matching_stp8.csv
        contemporary_stp9: output/input_contemporary_matching_stp9.csv
        contemporary_stp10: output/input_contemporary_matching_stp10.csv
        contemporary_stp12: output/input_contemporary_matching_stp12.csv
        contemporary_stp13: output/input_contemporary_matching_stp13.csv
        contemporary_stp14: output/input_contemporary_matching_stp14.csv
        contemporary_stp15: output/input_contemporary_matching_stp15.csv
        contemporary_stp16: output/input_contemporary_matching_stp16.csv
        contemporary_stp17: output/input_contemporary_matching_stp17.csv
        contemporary_stp20: output/input_contemporary_matching_stp20.csv
        contemporary_stp21: output/input_contemporary_matching_stp21.csv
        contemporary_stp22: output/input_contemporary_matching_stp22.csv
        contemporary_stp23: output/input_contemporary_matching_stp23.csv
        contemporary_stp24: output/input_contemporary_matching_stp24.csv
        contemporary_stp25: output/input_contemporary_matching_stp25.csv
        contemporary_stp26: output/input_contemporary_matching_stp26.csv
        contemporary_stp27: output/input_contemporary_matching_stp27.csv
        contemporary_stp29: output/input_contemporary_matching_stp29.csv
        contemporary_stp33: output/input_contemporary_matching_stp33.csv
        contemporary_stp35: output/input_contemporary_matching_stp35.csv
        contemporary_stp36: output/input_contemporary_matching_stp36.csv
        contemporary_stp37: output/input_contemporary_matching_stp37.csv
        contemporary_stp40: output/input_contemporary_matching_stp40.csv
        contemporary_stp41: output/input_contemporary_matching_stp41.csv
        contemporary_stp42: output/input_contemporary_matching_stp42.csv
        contemporary_stp43: output/input_contemporary_matching_stp43.csv
        contemporary_stp44: output/input_contemporary_matching_stp44.csv
        contemporary_stp49: output/input_contemporary_matching_stp49.csv
      moderately_sensitive:
        log: logs/split_stps.log

# Split covid_matching and contemporary_matching by STP
  split_stps:
    run: stata-mp:latest analysis/split_stps.do
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching]
    outputs:
      highly_sensitive:
        covid_stp5: output/input_covid_matching_stp5.csv
        covid_stp6: output/input_covid_matching_stp6.csv
        covid_stp7: output/input_covid_matching_stp7.csv
        covid_stp8: output/input_covid_matching_stp8.csv
        covid_stp9: output/input_covid_matching_stp9.csv
        covid_stp10: output/input_covid_matching_stp10.csv
        covid_stp12: output/input_covid_matching_stp12.csv
        covid_stp13: output/input_covid_matching_stp13.csv
        covid_stp14: output/input_covid_matching_stp14.csv
        covid_stp15: output/input_covid_matching_stp15.csv
        covid_stp16: output/input_covid_matching_stp16.csv
        covid_stp17: output/input_covid_matching_stp17.csv
        covid_stp20: output/input_covid_matching_stp20.csv
        covid_stp21: output/input_covid_matching_stp21.csv
        covid_stp22: output/input_covid_matching_stp22.csv
        covid_stp23: output/input_covid_matching_stp23.csv
        covid_stp24: output/input_covid_matching_stp24.csv
        covid_stp25: output/input_covid_matching_stp25.csv
        covid_stp26: output/input_covid_matching_stp26.csv
        covid_stp27: output/input_covid_matching_stp27.csv
        covid_stp29: output/input_covid_matching_stp29.csv
        covid_stp33: output/input_covid_matching_stp33.csv
        covid_stp35: output/input_covid_matching_stp35.csv
        covid_stp36: output/input_covid_matching_stp36.csv
        covid_stp37: output/input_covid_matching_stp37.csv
        covid_stp40: output/input_covid_matching_stp40.csv
        covid_stp41: output/input_covid_matching_stp41.csv
        covid_stp42: output/input_covid_matching_stp42.csv
        covid_stp43: output/input_covid_matching_stp43.csv
        covid_stp44: output/input_covid_matching_stp44.csv
        covid_stp49: output/input_covid_matching_stp49.csv
        contemporary_stp5: output/input_contemporary_matching_stp5.csv
        contemporary_stp6: output/input_contemporary_matching_stp6.csv
        contemporary_stp7: output/input_contemporary_matching_stp7.csv
        contemporary_stp8: output/input_contemporary_matching_stp8.csv
        contemporary_stp9: output/input_contemporary_matching_stp9.csv
        contemporary_stp10: output/input_contemporary_matching_stp10.csv
        contemporary_stp12: output/input_contemporary_matching_stp12.csv
        contemporary_stp13: output/input_contemporary_matching_stp13.csv
        contemporary_stp14: output/input_contemporary_matching_stp14.csv
        contemporary_stp15: output/input_contemporary_matching_stp15.csv
        contemporary_stp16: output/input_contemporary_matching_stp16.csv
        contemporary_stp17: output/input_contemporary_matching_stp17.csv
        contemporary_stp20: output/input_contemporary_matching_stp20.csv
        contemporary_stp21: output/input_contemporary_matching_stp21.csv
        contemporary_stp22: output/input_contemporary_matching_stp22.csv
        contemporary_stp23: output/input_contemporary_matching_stp23.csv
        contemporary_stp24: output/input_contemporary_matching_stp24.csv
        contemporary_stp25: output/input_contemporary_matching_stp25.csv
        contemporary_stp26: output/input_contemporary_matching_stp26.csv
        contemporary_stp27: output/input_contemporary_matching_stp27.csv
        contemporary_stp29: output/input_contemporary_matching_stp29.csv
        contemporary_stp33: output/input_contemporary_matching_stp33.csv
        contemporary_stp35: output/input_contemporary_matching_stp35.csv
        contemporary_stp36: output/input_contemporary_matching_stp36.csv
        contemporary_stp37: output/input_contemporary_matching_stp37.csv
        contemporary_stp40: output/input_contemporary_matching_stp40.csv
        contemporary_stp41: output/input_contemporary_matching_stp41.csv
        contemporary_stp42: output/input_contemporary_matching_stp42.csv
        contemporary_stp43: output/input_contemporary_matching_stp43.csv
        contemporary_stp44: output/input_contemporary_matching_stp44.csv
        contemporary_stp49: output/input_contemporary_matching_stp49.csv
      moderately_sensitive:
        log: logs/split_stps.log

  match_contemporary_stp5:
    run: python:latest python analysis/match_contemporary_stp5.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp5: output/matching_report_contemporary_stp5.txt
      highly_sensitive:
        matched_matches_stp5: output/matched_matches_contemporary_stp5.csv
        matched_cases_stp5: output/matched_cases_contemporary_stp5.csv
        matched_all_stp5: output/matched_combined_contemporary_stp5.csv

  match_contemporary_stp6:
    run: python:latest python analysis/match_contemporary_stp6.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp6: output/matching_report_contemporary_stp6.txt
      highly_sensitive:
        matched_matches_stp6: output/matched_matches_contemporary_stp6.csv
        matched_cases_stp6: output/matched_cases_contemporary_stp6.csv
        matched_all_stp6: output/matched_combined_contemporary_stp6.csv

  match_contemporary_stp7:
    run: python:latest python analysis/match_contemporary_stp7.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp7: output/matching_report_contemporary_stp7.txt
      highly_sensitive:
        matched_matches_stp7: output/matched_matches_contemporary_stp7.csv
        matched_cases_stp7: output/matched_cases_contemporary_stp7.csv
        matched_all_stp7: output/matched_combined_contemporary_stp7.csv

  match_contemporary_stp8:
    run: python:latest python analysis/match_contemporary_stp8.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp8: output/matching_report_contemporary_stp8.txt
      highly_sensitive:
        matched_matches_stp8: output/matched_matches_contemporary_stp8.csv
        matched_cases_stp8: output/matched_cases_contemporary_stp8.csv
        matched_all_stp8: output/matched_combined_contemporary_stp8.csv

  match_contemporary_stp9:
    run: python:latest python analysis/match_contemporary_stp9.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp9: output/matching_report_contemporary_stp9.txt
      highly_sensitive:
        matched_matches_stp9: output/matched_matches_contemporary_stp9.csv
        matched_cases_stp9: output/matched_cases_contemporary_stp9.csv
        matched_all_stp9: output/matched_combined_contemporary_stp9.csv

  match_contemporary_stp10:
    run: python:latest python analysis/match_contemporary_stp10.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp10: output/matching_report_contemporary_stp10.txt
      highly_sensitive:
        matched_matches_stp10: output/matched_matches_contemporary_stp10.csv
        matched_cases_stp10: output/matched_cases_contemporary_stp10.csv
        matched_all_stp10: output/matched_combined_contemporary_stp10.csv

  match_contemporary_stp12:
    run: python:latest python analysis/match_contemporary_stp12.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp12: output/matching_report_contemporary_stp12.txt
      highly_sensitive:
        matched_matches_stp12: output/matched_matches_contemporary_stp12.csv
        matched_cases_stp12: output/matched_cases_contemporary_stp12.csv
        matched_all_stp12: output/matched_combined_contemporary_stp12.csv

  match_contemporary_stp13:
    run: python:latest python analysis/match_contemporary_stp13.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp13: output/matching_report_contemporary_stp13.txt
      highly_sensitive:
        matched_matches_stp13: output/matched_matches_contemporary_stp13.csv
        matched_cases_stp13: output/matched_cases_contemporary_stp13.csv
        matched_all_stp13: output/matched_combined_contemporary_stp13.csv

  match_contemporary_stp14:
    run: python:latest python analysis/match_contemporary_stp14.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp14: output/matching_report_contemporary_stp14.txt
      highly_sensitive:
        matched_matches_stp14: output/matched_matches_contemporary_stp14.csv
        matched_cases_stp14: output/matched_cases_contemporary_stp14.csv
        matched_all_stp14: output/matched_combined_contemporary_stp14.csv

  match_contemporary_stp15:
    run: python:latest python analysis/match_contemporary_stp15.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp15: output/matching_report_contemporary_stp15.txt
      highly_sensitive:
        matched_matches_stp15: output/matched_matches_contemporary_stp15.csv
        matched_cases_stp15: output/matched_cases_contemporary_stp15.csv
        matched_all_stp15: output/matched_combined_contemporary_stp15.csv

  match_contemporary_stp16:
    run: python:latest python analysis/match_contemporary_stp16.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp16: output/matching_report_contemporary_stp16.txt
      highly_sensitive:
        matched_matches_stp16: output/matched_matches_contemporary_stp16.csv
        matched_cases_stp16: output/matched_cases_contemporary_stp16.csv
        matched_all_stp16: output/matched_combined_contemporary_stp16.csv

  match_contemporary_stp17:
    run: python:latest python analysis/match_contemporary_stp17.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp17: output/matching_report_contemporary_stp17.txt
      highly_sensitive:
        matched_matches_stp17: output/matched_matches_contemporary_stp17.csv
        matched_cases_stp17: output/matched_cases_contemporary_stp17.csv
        matched_all_stp17: output/matched_combined_contemporary_stp17.csv

  match_contemporary_stp20:
    run: python:latest python analysis/match_contemporary_stp20.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp20: output/matching_report_contemporary_stp20.txt
      highly_sensitive:
        matched_matches_stp20: output/matched_matches_contemporary_stp20.csv
        matched_cases_stp20: output/matched_cases_contemporary_stp20.csv
        matched_all_stp20: output/matched_combined_contemporary_stp20.csv

  match_contemporary_stp21:
    run: python:latest python analysis/match_contemporary_stp21.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp21: output/matching_report_contemporary_stp21.txt
      highly_sensitive:
        matched_matches_stp21: output/matched_matches_contemporary_stp21.csv
        matched_cases_stp21: output/matched_cases_contemporary_stp21.csv
        matched_all_stp21: output/matched_combined_contemporary_stp21.csv

  match_contemporary_stp22:
    run: python:latest python analysis/match_contemporary_stp22.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp22: output/matching_report_contemporary_stp22.txt
      highly_sensitive:
        matched_matches_stp22: output/matched_matches_contemporary_stp22.csv
        matched_cases_stp22: output/matched_cases_contemporary_stp22.csv
        matched_all_stp22: output/matched_combined_contemporary_stp22.csv

  match_contemporary_stp23:
    run: python:latest python analysis/match_contemporary_stp23.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp23: output/matching_report_contemporary_stp23.txt
      highly_sensitive:
        matched_matches_stp23: output/matched_matches_contemporary_stp23.csv
        matched_cases_stp23: output/matched_cases_contemporary_stp23.csv
        matched_all_stp23: output/matched_combined_contemporary_stp23.csv

  match_contemporary_stp24:
    run: python:latest python analysis/match_contemporary_stp24.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp24: output/matching_report_contemporary_stp24.txt
      highly_sensitive:
        matched_matches_stp24: output/matched_matches_contemporary_stp24.csv
        matched_cases_stp24: output/matched_cases_contemporary_stp24.csv
        matched_all_stp24: output/matched_combined_contemporary_stp24.csv

  match_contemporary_stp25:
    run: python:latest python analysis/match_contemporary_stp25.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp25: output/matching_report_contemporary_stp25.txt
      highly_sensitive:
        matched_matches_stp25: output/matched_matches_contemporary_stp25.csv
        matched_cases_stp25: output/matched_cases_contemporary_stp25.csv
        matched_all_stp25: output/matched_combined_contemporary_stp25.csv

  match_contemporary_stp26:
    run: python:latest python analysis/match_contemporary_stp26.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp26: output/matching_report_contemporary_stp26.txt
      highly_sensitive:
        matched_matches_stp26: output/matched_matches_contemporary_stp26.csv
        matched_cases_stp26: output/matched_cases_contemporary_stp26.csv
        matched_all_stp26: output/matched_combined_contemporary_stp26.csv

  match_contemporary_stp27:
    run: python:latest python analysis/match_contemporary_stp27.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp27: output/matching_report_contemporary_stp27.txt
      highly_sensitive:
        matched_matches_stp27: output/matched_matches_contemporary_stp27.csv
        matched_cases_stp27: output/matched_cases_contemporary_stp27.csv
        matched_all_stp27: output/matched_combined_contemporary_stp27.csv

  match_contemporary_stp29:
    run: python:latest python analysis/match_contemporary_stp29.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp29: output/matching_report_contemporary_stp29.txt
      highly_sensitive:
        matched_matches_stp29: output/matched_matches_contemporary_stp29.csv
        matched_cases_stp29: output/matched_cases_contemporary_stp29.csv
        matched_all_stp29: output/matched_combined_contemporary_stp29.csv

  match_contemporary_stp33:
    run: python:latest python analysis/match_contemporary_stp33.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp33: output/matching_report_contemporary_stp33.txt
      highly_sensitive:
        matched_matches_stp33: output/matched_matches_contemporary_stp33.csv
        matched_cases_stp33: output/matched_cases_contemporary_stp33.csv
        matched_all_stp33: output/matched_combined_contemporary_stp33.csv

  match_contemporary_stp35:
    run: python:latest python analysis/match_contemporary_stp35.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp35: output/matching_report_contemporary_stp35.txt
      highly_sensitive:
        matched_matches_stp35: output/matched_matches_contemporary_stp35.csv
        matched_cases_stp35: output/matched_cases_contemporary_stp35.csv
        matched_all_stp35: output/matched_combined_contemporary_stp35.csv

  match_contemporary_stp36:
    run: python:latest python analysis/match_contemporary_stp36.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp36: output/matching_report_contemporary_stp36.txt
      highly_sensitive:
        matched_matches_stp36: output/matched_matches_contemporary_stp36.csv
        matched_cases_stp36: output/matched_cases_contemporary_stp36.csv
        matched_all_stp36: output/matched_combined_contemporary_stp36.csv

  match_contemporary_stp37:
    run: python:latest python analysis/match_contemporary_stp37.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp37: output/matching_report_contemporary_stp37.txt
      highly_sensitive:
        matched_matches_stp37: output/matched_matches_contemporary_stp37.csv
        matched_cases_stp37: output/matched_cases_contemporary_stp37.csv
        matched_all_stp37: output/matched_combined_contemporary_stp37.csv

  match_contemporary_stp40:
    run: python:latest python analysis/match_contemporary_stp40.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp40: output/matching_report_contemporary_stp40.txt
      highly_sensitive:
        matched_matches_stp40: output/matched_matches_contemporary_stp40.csv
        matched_cases_stp40: output/matched_cases_contemporary_stp40.csv
        matched_all_stp40: output/matched_combined_contemporary_stp40.csv

  match_contemporary_stp41:
    run: python:latest python analysis/match_contemporary_stp41.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp41: output/matching_report_contemporary_stp41.txt
      highly_sensitive:
        matched_matches_stp41: output/matched_matches_contemporary_stp41.csv
        matched_cases_stp41: output/matched_cases_contemporary_stp41.csv
        matched_all_stp41: output/matched_combined_contemporary_stp41.csv

  match_contemporary_stp42:
    run: python:latest python analysis/match_contemporary_stp42.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp42: output/matching_report_contemporary_stp42.txt
      highly_sensitive:
        matched_matches_stp42: output/matched_matches_contemporary_stp42.csv
        matched_cases_stp42: output/matched_cases_contemporary_stp42.csv
        matched_all_stp42: output/matched_combined_contemporary_stp42.csv

  match_contemporary_stp43:
    run: python:latest python analysis/match_contemporary_stp43.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp43: output/matching_report_contemporary_stp43.txt
      highly_sensitive:
        matched_matches_stp43: output/matched_matches_contemporary_stp43.csv
        matched_cases_stp43: output/matched_cases_contemporary_stp43.csv
        matched_all_stp43: output/matched_combined_contemporary_stp43.csv

  match_contemporary_stp44:
    run: python:latest python analysis/match_contemporary_stp44.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp44: output/matching_report_contemporary_stp44.txt
      highly_sensitive:
        matched_matches_stp44: output/matched_matches_contemporary_stp44.csv
        matched_cases_stp44: output/matched_cases_contemporary_stp44.csv
        matched_all_stp44: output/matched_combined_contemporary_stp44.csv

  match_contemporary_stp49:
    run: python:latest python analysis/match_contemporary_stp49.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report_stp49: output/matching_report_contemporary_stp49.txt
      highly_sensitive:

        matched_matches_stp49: output/matched_matches_contemporary_stp49.csv
        matched_cases_stp49: output/matched_cases_contemporary_stp49.csv
        matched_all_stp49: output/matched_combined_contemporary_stp49.csv

  match_contemporary_stp5_noimd:
    run: python:latest python analysis/match_contemporary_stp5_noimd.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report: output/matching_report_contemporary_stp5_noimd.txt
      highly_sensitive:
        matched_matches: output/matched_matches_contemporary_stp5_noimd.csv

  match_contemporary_stp5_nosex:
    run: python:latest python analysis/match_contemporary_stp5_nosex.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report: output/matching_report_contemporary_stp5_nosex.txt
      highly_sensitive:
        matched_matches: output/matched_matches_contemporary_stp5_nosex.csv

  match_contemporary_stp5_noyearofbirth:
    run: python:latest python analysis/match_contemporary_stp5_noyearofbirth.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report: output/matching_report_contemporary_stp5_noyearofbirth.txt
      highly_sensitive:
        matched_matches: output/matched_matches_contemporary_stp5_noyearofbirth.csv

  match_contemporary_stp5_onlyimd:
    run: python:latest python analysis/match_contemporary_stp5_onlyimd.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report: output/matching_report_contemporary_stp5_onlyimd.txt
      highly_sensitive:
        matched_matches: output/matched_matches_contemporary_stp5_onlyimd.csv

  match_contemporary_stp5_onlysex:
    run: python:latest python analysis/match_contemporary_stp5_onlysex.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report: output/matching_report_contemporary_stp5_onlysex.txt
      highly_sensitive:
        matched_matches: output/matched_matches_contemporary_stp5_onlysex.csv

  match_contemporary_stp5_onlyyearofbirth:
    run: python:latest python analysis/match_contemporary_stp5_onlyyearofbirth.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report: output/matching_report_contemporary_stp5_onlyyearofbirth.txt
      highly_sensitive:
        matched_matches: output/matched_matches_contemporary_stp5_onlyyearofbirth.csv

  match_contemporary_stp5_wideyearofbirth:
    run: python:latest python analysis/match_contemporary_stp5_wideyearofbirth.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report: output/matching_report_contemporary_stp5_wideyearofbirth.txt
      highly_sensitive:
        matched_matches: output/matched_matches_contemporary_stp5_wideyearofbirth.csv

  match_contemporary_stp35_noimd:
    run: python:latest python analysis/match_contemporary_stp35_noimd.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report: output/matching_report_contemporary_stp35_noimd.txt
      highly_sensitive:
        matched_matches: output/matched_matches_contemporary_stp35_noimd.csv

  match_contemporary_stp35_nosex:
    run: python:latest python analysis/match_contemporary_stp35_nosex.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report: output/matching_report_contemporary_stp35_nosex.txt
      highly_sensitive:
        matched_matches: output/matched_matches_contemporary_stp35_nosex.csv

  match_contemporary_stp35_noyearofbirth:
    run: python:latest python analysis/match_contemporary_stp35_noyearofbirth.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report: output/matching_report_contemporary_stp35_noyearofbirth.txt
      highly_sensitive:
        matched_matches: output/matched_matches_contemporary_stp35_noyearofbirth.csv

  match_contemporary_stp35_onlyimd:
    run: python:latest python analysis/match_contemporary_stp35_onlyimd.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report: output/matching_report_contemporary_stp35_onlyimd.txt
      highly_sensitive:
        matched_matches: output/matched_matches_contemporary_stp35_onlyimd.csv

  match_contemporary_stp35_onlysex:
    run: python:latest python analysis/match_contemporary_stp35_onlysex.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report: output/matching_report_contemporary_stp35_onlysex.txt
      highly_sensitive:
        matched_matches: output/matched_matches_contemporary_stp35_onlysex.csv

  match_contemporary_stp35_onlyyearofbirth:
    run: python:latest python analysis/match_contemporary_stp35_onlyyearofbirth.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report: output/matching_report_contemporary_stp35_onlyyearofbirth.txt
      highly_sensitive:
        matched_matches: output/matched_matches_contemporary_stp35_onlyyearofbirth.csv

  match_contemporary_stp35_wideyearofbirth:
    run: python:latest python analysis/match_contemporary_stp35_wideyearofbirth.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report: output/matching_report_contemporary_stp35_wideyearofbirth.txt
      highly_sensitive:
        matched_matches: output/matched_matches_contemporary_stp35_wideyearofbirth.csv

  match_contemporary_stp35_yearsex:
    run: python:latest python analysis/match_contemporary_stp35_yearsex.py
    needs: [extract_covid_matching, clean_covid_matching, extract_contemporary_matching, clean_contemporary_matching, split_stps]
    outputs:
      moderately_sensitive:
        matching_report: output/matching_report_contemporary_stp35_yearsex.txt
      highly_sensitive:
        matched_matches: output/matched_matches_contemporary_stp35_yearsex.csv


 # Check STPs
  check_stps:
    run: stata-mp:latest analysis/check_stps.do
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2017_matching, clean_2017_matching]
    outputs:
      moderately_sensitive:
        log: logs/check_stps.log

# Extract data required for matching for covid (all STPs)
  extract_covid_2017_matching_may2021:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_covid_2017_matching_may2021
    outputs:
      highly_sensitive:
        cohort: output/input_covid_2017_matching_may2021.csv

#Data management for covid_2017_matching
  clean_covid_2017_matching_may2021:
    run: stata-mp:latest analysis/covid_2017_matching_may2021.do
    needs: [extract_covid_2017_matching_may2021]
    outputs:
      highly_sensitive:
        analysis_dataset: output/covid_2017_matching_may2021.csv
      moderately_sensitive:
        log: logs/covid_2017_matching_may2021.log

# Extract data required for matching for 2017 (all STPs)
  extract_2017_matching_may2021:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_2017_matching_may2021
    outputs:
      highly_sensitive:
        cohort: output/input_2017_matching_may2021.csv

#Data management for 2017_matching
  clean_2017_matching_may2021:
    run: stata-mp:latest analysis/2017_matching_may2021.do
    needs: [extract_2017_matching_may2021]
    outputs:
      highly_sensitive:
        analysis_dataset: output/2017_matching_may2021.csv
      moderately_sensitive:
        log: logs/2017_matching_may2021.log

# Split covid_2017_matching and 2017_matching by STP
  split_stps_may2021:
    run: stata-mp:latest analysis/split_stps_may2021.do
    needs: [extract_covid_2017_matching_may2021, clean_covid_2017_matching_may2021, extract_2017_matching_may2021, clean_2017_matching_may2021]
    outputs:
      highly_sensitive:
        covid_stp5_may2021: output/input_covid_2017_matching_stp5_may2021.csv
        covid_stp6_may2021: output/input_covid_2017_matching_stp6_may2021.csv
        covid_stp7_may2021: output/input_covid_2017_matching_stp7_may2021.csv
        covid_stp8_may2021: output/input_covid_2017_matching_stp8_may2021.csv
        covid_stp9_may2021: output/input_covid_2017_matching_stp9_may2021.csv
        covid_stp10_may2021: output/input_covid_2017_matching_stp10_may2021.csv
        covid_stp12_may2021: output/input_covid_2017_matching_stp12_may2021.csv
        covid_stp13_may2021: output/input_covid_2017_matching_stp13_may2021.csv
        covid_stp14_may2021: output/input_covid_2017_matching_stp14_may2021.csv
        covid_stp15_may2021: output/input_covid_2017_matching_stp15_may2021.csv
        covid_stp16_may2021: output/input_covid_2017_matching_stp16_may2021.csv
        covid_stp17_may2021: output/input_covid_2017_matching_stp17_may2021.csv
        covid_stp20_may2021: output/input_covid_2017_matching_stp20_may2021.csv
        covid_stp21_may2021: output/input_covid_2017_matching_stp21_may2021.csv
        covid_stp22_may2021: output/input_covid_2017_matching_stp22_may2021.csv
        covid_stp23_may2021: output/input_covid_2017_matching_stp23_may2021.csv
        covid_stp24_may2021: output/input_covid_2017_matching_stp24_may2021.csv
        covid_stp25_may2021: output/input_covid_2017_matching_stp25_may2021.csv
        covid_stp26_may2021: output/input_covid_2017_matching_stp26_may2021.csv
        covid_stp27_may2021: output/input_covid_2017_matching_stp27_may2021.csv
        covid_stp29_may2021: output/input_covid_2017_matching_stp29_may2021.csv
        covid_stp33_may2021: output/input_covid_2017_matching_stp33_may2021.csv
        covid_stp35_may2021: output/input_covid_2017_matching_stp35_may2021.csv
        covid_stp36_may2021: output/input_covid_2017_matching_stp36_may2021.csv
        covid_stp37_may2021: output/input_covid_2017_matching_stp37_may2021.csv
        covid_stp40_may2021: output/input_covid_2017_matching_stp40_may2021.csv
        covid_stp41_may2021: output/input_covid_2017_matching_stp41_may2021.csv
        covid_stp42_may2021: output/input_covid_2017_matching_stp42_may2021.csv
        covid_stp43_may2021: output/input_covid_2017_matching_stp43_may2021.csv
        covid_stp44_may2021: output/input_covid_2017_matching_stp44_may2021.csv
        covid_stp49_may2021: output/input_covid_2017_matching_stp49_may2021.csv
        2017_stp5_may2021: output/input_2017_matching_stp5_may2021.csv
        2017_stp6_may2021: output/input_2017_matching_stp6_may2021.csv
        2017_stp7_may2021: output/input_2017_matching_stp7_may2021.csv
        2017_stp8_may2021: output/input_2017_matching_stp8_may2021.csv
        2017_stp9_may2021: output/input_2017_matching_stp9_may2021.csv
        2017_stp10_may2021: output/input_2017_matching_stp10_may2021.csv
        2017_stp12_may2021: output/input_2017_matching_stp12_may2021.csv
        2017_stp13_may2021: output/input_2017_matching_stp13_may2021.csv
        2017_stp14_may2021: output/input_2017_matching_stp14_may2021.csv
        2017_stp15_may2021: output/input_2017_matching_stp15_may2021.csv
        2017_stp16_may2021: output/input_2017_matching_stp16_may2021.csv
        2017_stp17_may2021: output/input_2017_matching_stp17_may2021.csv
        2017_stp20_may2021: output/input_2017_matching_stp20_may2021.csv
        2017_stp21_may2021: output/input_2017_matching_stp21_may2021.csv
        2017_stp22_may2021: output/input_2017_matching_stp22_may2021.csv
        2017_stp23_may2021: output/input_2017_matching_stp23_may2021.csv
        2017_stp24_may2021: output/input_2017_matching_stp24_may2021.csv
        2017_stp25_may2021: output/input_2017_matching_stp25_may2021.csv
        2017_stp26_may2021: output/input_2017_matching_stp26_may2021.csv
        2017_stp27_may2021: output/input_2017_matching_stp27_may2021.csv
        2017_stp29_may2021: output/input_2017_matching_stp29_may2021.csv
        2017_stp33_may2021: output/input_2017_matching_stp33_may2021.csv
        2017_stp35_may2021: output/input_2017_matching_stp35_may2021.csv
        2017_stp36_may2021: output/input_2017_matching_stp36_may2021.csv
        2017_stp37_may2021: output/input_2017_matching_stp37_may2021.csv
        2017_stp40_may2021: output/input_2017_matching_stp40_may2021.csv
        2017_stp41_may2021: output/input_2017_matching_stp41_may2021.csv
        2017_stp42_may2021: output/input_2017_matching_stp42_may2021.csv
        2017_stp43_may2021: output/input_2017_matching_stp43_may2021.csv
        2017_stp44_may2021: output/input_2017_matching_stp44_may2021.csv
        2017_stp49_may2021: output/input_2017_matching_stp49_may2021.csv
      moderately_sensitive:
        log: logs/split_stps_may2021.log

  match_2017_stp35_may2021:
    run: python:latest python analysis/match_2017_stp35_may2021.py
    needs: [extract_covid_2017_matching_may2021, clean_covid_2017_matching_may2021, extract_2017_matching_may2021, clean_2017_matching_may2021, split_stps_may2021]
    outputs:
      moderately_sensitive:
        matching_report_stp35_may2021: output/matching_report_2017_stp35_may2021.txt
      highly_sensitive:
        matched_matches_stp35_may2021: output/matched_matches_2017_stp35_may2021.csv
        matched_cases_stp35_may2021: output/matched_cases_2017_stp35_may2021.csv
        matched_all_stp35_may2021: output/matched_combined_2017_stp35_may2021.csv


#Extract data required for matching for 2020 (all STPs)
  extract_2020_matching:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_2020_matching
    outputs:
      highly_sensitive:
        cohort: output/input_2020_matching.csv

#Data management for 2020_matching
  clean_2020_matching:
    run: stata-mp:latest analysis/2020_matching.do
    needs: [extract_2020_matching]
    outputs:
      highly_sensitive:
        analysis_dataset: output/2020_matching.csv
      moderately_sensitive:
        log: logs/2020_matching.log

# Split covid_2017_matching and 2020_matching by STP
  split_stps_2020:
    run: stata-mp:latest analysis/split_stps_2020.do
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching]
    outputs:
      highly_sensitive:
        covid_stp5: output/input_covid_2020_matching_stp5.csv
        covid_stp6: output/input_covid_2020_matching_stp6.csv
        covid_stp7: output/input_covid_2020_matching_stp7.csv
        covid_stp8: output/input_covid_2020_matching_stp8.csv
        covid_stp9: output/input_covid_2020_matching_stp9.csv
        covid_stp10: output/input_covid_2020_matching_stp10.csv
        covid_stp12: output/input_covid_2020_matching_stp12.csv
        covid_stp13: output/input_covid_2020_matching_stp13.csv
        covid_stp14: output/input_covid_2020_matching_stp14.csv
        covid_stp15: output/input_covid_2020_matching_stp15.csv
        covid_stp16: output/input_covid_2020_matching_stp16.csv
        covid_stp17: output/input_covid_2020_matching_stp17.csv
        covid_stp20: output/input_covid_2020_matching_stp20.csv
        covid_stp21: output/input_covid_2020_matching_stp21.csv
        covid_stp22: output/input_covid_2020_matching_stp22.csv
        covid_stp23: output/input_covid_2020_matching_stp23.csv
        covid_stp24: output/input_covid_2020_matching_stp24.csv
        covid_stp25: output/input_covid_2020_matching_stp25.csv
        covid_stp26: output/input_covid_2020_matching_stp26.csv
        covid_stp27: output/input_covid_2020_matching_stp27.csv
        covid_stp29: output/input_covid_2020_matching_stp29.csv
        covid_stp33: output/input_covid_2020_matching_stp33.csv
        covid_stp35: output/input_covid_2020_matching_stp35.csv
        covid_stp36: output/input_covid_2020_matching_stp36.csv
        covid_stp37: output/input_covid_2020_matching_stp37.csv
        covid_stp40: output/input_covid_2020_matching_stp40.csv
        covid_stp41: output/input_covid_2020_matching_stp41.csv
        covid_stp42: output/input_covid_2020_matching_stp42.csv
        covid_stp43: output/input_covid_2020_matching_stp43.csv
        covid_stp44: output/input_covid_2020_matching_stp44.csv
        covid_stp49: output/input_covid_2020_matching_stp49.csv
        2020_stp5: output/input_2020_matching_stp5.csv
        2020_stp6: output/input_2020_matching_stp6.csv
        2020_stp7: output/input_2020_matching_stp7.csv
        2020_stp8: output/input_2020_matching_stp8.csv
        2020_stp9: output/input_2020_matching_stp9.csv
        2020_stp10: output/input_2020_matching_stp10.csv
        2020_stp12: output/input_2020_matching_stp12.csv
        2020_stp13: output/input_2020_matching_stp13.csv
        2020_stp14: output/input_2020_matching_stp14.csv
        2020_stp15: output/input_2020_matching_stp15.csv
        2020_stp16: output/input_2020_matching_stp16.csv
        2020_stp17: output/input_2020_matching_stp17.csv
        2020_stp20: output/input_2020_matching_stp20.csv
        2020_stp21: output/input_2020_matching_stp21.csv
        2020_stp22: output/input_2020_matching_stp22.csv
        2020_stp23: output/input_2020_matching_stp23.csv
        2020_stp24: output/input_2020_matching_stp24.csv
        2020_stp25: output/input_2020_matching_stp25.csv
        2020_stp26: output/input_2020_matching_stp26.csv
        2020_stp27: output/input_2020_matching_stp27.csv
        2020_stp29: output/input_2020_matching_stp29.csv
        2020_stp33: output/input_2020_matching_stp33.csv
        2020_stp35: output/input_2020_matching_stp35.csv
        2020_stp36: output/input_2020_matching_stp36.csv
        2020_stp37: output/input_2020_matching_stp37.csv
        2020_stp40: output/input_2020_matching_stp40.csv
        2020_stp41: output/input_2020_matching_stp41.csv
        2020_stp42: output/input_2020_matching_stp42.csv
        2020_stp43: output/input_2020_matching_stp43.csv
        2020_stp44: output/input_2020_matching_stp44.csv
        2020_stp49: output/input_2020_matching_stp49.csv
      moderately_sensitive:
        log: logs/split_stps_2020.log

  match_2020_stp5:
    run: python:latest python analysis/match_2020_stp5.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp5: output/matching_report_2020_stp5.txt
      highly_sensitive:
        matched_matches_stp5: output/matched_matches_2020_stp5.csv
        matched_cases_stp5: output/matched_cases_2020_stp5.csv
        matched_all_stp5: output/matched_combined_2020_stp5.csv

  match_2020_stp6:
    run: python:latest python analysis/match_2020_stp6.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp6: output/matching_report_2020_stp6.txt
      highly_sensitive:
        matched_matches_stp6: output/matched_matches_2020_stp6.csv
        matched_cases_stp6: output/matched_cases_2020_stp6.csv
        matched_all_stp6: output/matched_combined_2020_stp6.csv

  match_2020_stp7:
    run: python:latest python analysis/match_2020_stp7.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp7: output/matching_report_2020_stp7.txt
      highly_sensitive:
        matched_matches_stp7: output/matched_matches_2020_stp7.csv
        matched_cases_stp7: output/matched_cases_2020_stp7.csv
        matched_all_stp7: output/matched_combined_2020_stp7.csv

  match_2020_stp8:
    run: python:latest python analysis/match_2020_stp8.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp8: output/matching_report_2020_stp8.txt
      highly_sensitive:
        matched_matches_stp8: output/matched_matches_2020_stp8.csv
        matched_cases_stp8: output/matched_cases_2020_stp8.csv
        matched_all_stp8: output/matched_combined_2020_stp8.csv

  match_2020_stp9:
    run: python:latest python analysis/match_2020_stp9.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp9: output/matching_report_2020_stp9.txt
      highly_sensitive:
        matched_matches_stp9: output/matched_matches_2020_stp9.csv
        matched_cases_stp9: output/matched_cases_2020_stp9.csv
        matched_all_stp9: output/matched_combined_2020_stp9.csv

  match_2020_stp10:
    run: python:latest python analysis/match_2020_stp10.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp10: output/matching_report_2020_stp10.txt
      highly_sensitive:
        matched_matches_stp10: output/matched_matches_2020_stp10.csv
        matched_cases_stp10: output/matched_cases_2020_stp10.csv
        matched_all_stp10: output/matched_combined_2020_stp10.csv

  match_2020_stp12:
    run: python:latest python analysis/match_2020_stp12.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp12: output/matching_report_2020_stp12.txt
      highly_sensitive:
        matched_matches_stp12: output/matched_matches_2020_stp12.csv
        matched_cases_stp12: output/matched_cases_2020_stp12.csv
        matched_all_stp12: output/matched_combined_2020_stp12.csv

  match_2020_stp13:
    run: python:latest python analysis/match_2020_stp13.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp13: output/matching_report_2020_stp13.txt
      highly_sensitive:
        matched_matches_stp13: output/matched_matches_2020_stp13.csv
        matched_cases_stp13: output/matched_cases_2020_stp13.csv
        matched_all_stp13: output/matched_combined_2020_stp13.csv

  match_2020_stp14:
    run: python:latest python analysis/match_2020_stp14.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp14: output/matching_report_2020_stp14.txt
      highly_sensitive:
        matched_matches_stp14: output/matched_matches_2020_stp14.csv
        matched_cases_stp14: output/matched_cases_2020_stp14.csv
        matched_all_stp14: output/matched_combined_2020_stp14.csv

  match_2020_stp15:
    run: python:latest python analysis/match_2020_stp15.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp15: output/matching_report_2020_stp15.txt
      highly_sensitive:
        matched_matches_stp15: output/matched_matches_2020_stp15.csv
        matched_cases_stp15: output/matched_cases_2020_stp15.csv
        matched_all_stp15: output/matched_combined_2020_stp15.csv

  match_2020_stp16:
    run: python:latest python analysis/match_2020_stp16.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp16: output/matching_report_2020_stp16.txt
      highly_sensitive:
        matched_matches_stp16: output/matched_matches_2020_stp16.csv
        matched_cases_stp16: output/matched_cases_2020_stp16.csv
        matched_all_stp16: output/matched_combined_2020_stp16.csv

  match_2020_stp17:
    run: python:latest python analysis/match_2020_stp17.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp17: output/matching_report_2020_stp17.txt
      highly_sensitive:
        matched_matches_stp17: output/matched_matches_2020_stp17.csv
        matched_cases_stp17: output/matched_cases_2020_stp17.csv
        matched_all_stp17: output/matched_combined_2020_stp17.csv

  match_2020_stp20:
    run: python:latest python analysis/match_2020_stp20.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp20: output/matching_report_2020_stp20.txt
      highly_sensitive:
        matched_matches_stp20: output/matched_matches_2020_stp20.csv
        matched_cases_stp20: output/matched_cases_2020_stp20.csv
        matched_all_stp20: output/matched_combined_2020_stp20.csv

  match_2020_stp21:
    run: python:latest python analysis/match_2020_stp21.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp21: output/matching_report_2020_stp21.txt
      highly_sensitive:
        matched_matches_stp21: output/matched_matches_2020_stp21.csv
        matched_cases_stp21: output/matched_cases_2020_stp21.csv
        matched_all_stp21: output/matched_combined_2020_stp21.csv

  match_2020_stp22:
    run: python:latest python analysis/match_2020_stp22.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp22: output/matching_report_2020_stp22.txt
      highly_sensitive:
        matched_matches_stp22: output/matched_matches_2020_stp22.csv
        matched_cases_stp22: output/matched_cases_2020_stp22.csv
        matched_all_stp22: output/matched_combined_2020_stp22.csv

  match_2020_stp23:
    run: python:latest python analysis/match_2020_stp23.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp23: output/matching_report_2020_stp23.txt
      highly_sensitive:
        matched_matches_stp23: output/matched_matches_2020_stp23.csv
        matched_cases_stp23: output/matched_cases_2020_stp23.csv
        matched_all_stp23: output/matched_combined_2020_stp23.csv

  match_2020_stp24:
    run: python:latest python analysis/match_2020_stp24.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp24: output/matching_report_2020_stp24.txt
      highly_sensitive:
        matched_matches_stp24: output/matched_matches_2020_stp24.csv
        matched_cases_stp24: output/matched_cases_2020_stp24.csv
        matched_all_stp24: output/matched_combined_2020_stp24.csv

  match_2020_stp25:
    run: python:latest python analysis/match_2020_stp25.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp25: output/matching_report_2020_stp25.txt
      highly_sensitive:
        matched_matches_stp25: output/matched_matches_2020_stp25.csv
        matched_cases_stp25: output/matched_cases_2020_stp25.csv
        matched_all_stp25: output/matched_combined_2020_stp25.csv

  match_2020_stp26:
    run: python:latest python analysis/match_2020_stp26.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp26: output/matching_report_2020_stp26.txt
      highly_sensitive:
        matched_matches_stp26: output/matched_matches_2020_stp26.csv
        matched_cases_stp26: output/matched_cases_2020_stp26.csv
        matched_all_stp26: output/matched_combined_2020_stp26.csv

  match_2020_stp27:
    run: python:latest python analysis/match_2020_stp27.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp27: output/matching_report_2020_stp27.txt
      highly_sensitive:
        matched_matches_stp27: output/matched_matches_2020_stp27.csv
        matched_cases_stp27: output/matched_cases_2020_stp27.csv
        matched_all_stp27: output/matched_combined_2020_stp27.csv

  match_2020_stp29:
    run: python:latest python analysis/match_2020_stp29.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp29: output/matching_report_2020_stp29.txt
      highly_sensitive:
        matched_matches_stp29: output/matched_matches_2020_stp29.csv
        matched_cases_stp29: output/matched_cases_2020_stp29.csv
        matched_all_stp29: output/matched_combined_2020_stp29.csv

  match_2020_stp33:
    run: python:latest python analysis/match_2020_stp33.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp33: output/matching_report_2020_stp33.txt
      highly_sensitive:
        matched_matches_stp33: output/matched_matches_2020_stp33.csv
        matched_cases_stp33: output/matched_cases_2020_stp33.csv
        matched_all_stp33: output/matched_combined_2020_stp33.csv

  match_2020_stp35:
    run: python:latest python analysis/match_2020_stp35.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp35: output/matching_report_2020_stp35.txt
      highly_sensitive:
        matched_matches_stp35: output/matched_matches_2020_stp35.csv
        matched_cases_stp35: output/matched_cases_2020_stp35.csv
        matched_all_stp35: output/matched_combined_2020_stp35.csv

  match_2020_stp36:
    run: python:latest python analysis/match_2020_stp36.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp36: output/matching_report_2020_stp36.txt
      highly_sensitive:
        matched_matches_stp36: output/matched_matches_2020_stp36.csv
        matched_cases_stp36: output/matched_cases_2020_stp36.csv
        matched_all_stp36: output/matched_combined_2020_stp36.csv

  match_2020_stp37:
    run: python:latest python analysis/match_2020_stp37.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp37: output/matching_report_2020_stp37.txt
      highly_sensitive:
        matched_matches_stp37: output/matched_matches_2020_stp37.csv
        matched_cases_stp37: output/matched_cases_2020_stp37.csv
        matched_all_stp37: output/matched_combined_2020_stp37.csv

  match_2020_stp40:
    run: python:latest python analysis/match_2020_stp40.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp40: output/matching_report_2020_stp40.txt
      highly_sensitive:
        matched_matches_stp40: output/matched_matches_2020_stp40.csv
        matched_cases_stp40: output/matched_cases_2020_stp40.csv
        matched_all_stp40: output/matched_combined_2020_stp40.csv

  match_2020_stp41:
    run: python:latest python analysis/match_2020_stp41.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp41: output/matching_report_2020_stp41.txt
      highly_sensitive:
        matched_matches_stp41: output/matched_matches_2020_stp41.csv
        matched_cases_stp41: output/matched_cases_2020_stp41.csv
        matched_all_stp41: output/matched_combined_2020_stp41.csv

  match_2020_stp42:
    run: python:latest python analysis/match_2020_stp42.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp42: output/matching_report_2020_stp42.txt
      highly_sensitive:
        matched_matches_stp42: output/matched_matches_2020_stp42.csv
        matched_cases_stp42: output/matched_cases_2020_stp42.csv
        matched_all_stp42: output/matched_combined_2020_stp42.csv

  match_2020_stp43:
    run: python:latest python analysis/match_2020_stp43.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp43: output/matching_report_2020_stp43.txt
      highly_sensitive:
        matched_matches_stp43: output/matched_matches_2020_stp43.csv
        matched_cases_stp43: output/matched_cases_2020_stp43.csv
        matched_all_stp43: output/matched_combined_2020_stp43.csv

  match_2020_stp44:
    run: python:latest python analysis/match_2020_stp44.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp44: output/matching_report_2020_stp44.txt
      highly_sensitive:
        matched_matches_stp44: output/matched_matches_2020_stp44.csv
        matched_cases_stp44: output/matched_cases_2020_stp44.csv
        matched_all_stp44: output/matched_combined_2020_stp44.csv

  match_2020_stp49:
    run: python:latest python analysis/match_2020_stp49.py
    needs: [extract_covid_2017_matching, clean_covid_2017_matching, extract_2020_matching, clean_2020_matching, split_stps_2020]
    outputs:
      moderately_sensitive:
        matching_report_stp49: output/matching_report_2020_stp49.txt
      highly_sensitive:
        matched_matches_stp49: output/matched_matches_2020_stp49.csv
        matched_cases_stp49: output/matched_cases_2020_stp49.csv
        matched_all_stp49: output/matched_combined_2020_stp49.csv

  combine_stps_covid_2020:
    run: stata-mp:latest analysis/combine_stps_covid_2020.do
    needs: [match_2020_stp5, match_2020_stp6, match_2020_stp7, match_2020_stp8, match_2020_stp9,
    match_2020_stp10, match_2020_stp12, match_2020_stp13, match_2020_stp14, match_2020_stp15,
    match_2020_stp16, match_2020_stp17, match_2020_stp20, match_2020_stp21, match_2020_stp22,
    match_2020_stp23, match_2020_stp24, match_2020_stp25, match_2020_stp26, match_2020_stp27,
    match_2020_stp29, match_2020_stp33, match_2020_stp35, match_2020_stp36, match_2020_stp37, 
    match_2020_stp40, match_2020_stp41, match_2020_stp42, match_2020_stp43, match_2020_stp44, 
    match_2020_stp49]
    outputs:
      highly_sensitive:
        matched_cases_combined: output/input_combined_stps_covid_2020.csv
      moderately_sensitive:
        log: logs/combine_stps_covid_2020.log


  combine_stps_matches_2020:
    run: stata-mp:latest analysis/combine_stps_matches_2020.do
    needs: [match_2020_stp5, match_2020_stp6, match_2020_stp7, match_2020_stp8, match_2020_stp9,
    match_2020_stp10, match_2020_stp12, match_2020_stp13, match_2020_stp14, match_2020_stp15,
    match_2020_stp16, match_2020_stp17, match_2020_stp20, match_2020_stp21, match_2020_stp22,
    match_2020_stp23, match_2020_stp24, match_2020_stp25, match_2020_stp26, match_2020_stp27,
    match_2020_stp29, match_2020_stp33, match_2020_stp35, match_2020_stp36, match_2020_stp37, 
    match_2020_stp40, match_2020_stp41, match_2020_stp42, match_2020_stp43, match_2020_stp44, 
    match_2020_stp49]
    outputs:
      highly_sensitive:
        matched_matches_combined: output/input_combined_stps_matches_2020.csv
      moderately_sensitive:
        log: logs/combine_stps_matches_2020.log